(this.webpackJsonpmopaint=this.webpackJsonpmopaint||[]).push([[0],{32:function(e,t,n){e.exports=n(84)},45:function(e,t,n){},68:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t){var n,a;window.simulateRandomGesture=function(e){for(var t=document.querySelector("canvas"),a=t.getBoundingClientRect(),o=function(e,n){var o=new MouseEvent(e,{view:window,bubbles:!0,cancelable:!0,clientX:a.left+n.x,clientY:a.top+n.y});t.dispatchEvent(o)},r=0,i=Math.random()*a.width,c=Math.random()*a.height,s=[],l=0;l<5;l+=1)s.push({rx:Math.random()*Math.min(a.width,a.height)/2/5,ry:Math.random()*Math.min(a.width,a.height)/2/5,angularFactor:5*Math.random()-Math.random(),angularOffset:5*Math.random()-Math.random()});var u=function(e){for(var t={x:i,y:c},n=0;n<s.length;n+=1){var a=s[n],o=a.rx,r=a.ry,l=a.angularFactor,u=a.angularOffset;t.x+=Math.sin(2*Math.PI*(e/100*l+u))*o,t.y+=Math.cos(2*Math.PI*(e/100*l+u))*r}return t};o("mousedown",u(r));!function t(){(r+=1)>50?(o("mouseup",u(r)),e&&e()):(o("mousemove",u(r)),n=setTimeout(t,10))}()},window.simulateRandomGesturesPeriodically=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=function t(){a=setTimeout((function(){window.simulateRandomGesture(t)}),e)};window.simulateRandomGesture(t)},window.stopSimulatingGestures=function(){clearTimeout(n),clearTimeout(a)}},84:function(e,t,n){"use strict";n.r(t);var a=n(5),o=n.n(a),r=n(18),i=n.n(r),c=n(0),s=n.n(c),l=n(9),u=n.n(l),d=(n(45),n(31)),h=n(8),m=n(1),f=n(2),p=n(14),v=n(4),g=n(3),w=n(6),y=n(27),b=n(28),E=n.n(b),O=n(19),D=n.n(O),N=n(29),k=n.n(N),I=n(20),S=n.n(I);function j(e,t,n){!function(e,t){var n=new FileReader;n.onload=function(){var e=n.result,a=new Uint8Array(e),o=D()(a);t(o)},n.readAsArrayBuffer(e)}(e,(function(e){for(var a in t)t.hasOwnProperty(a)&&e.splice(-1,0,S.a.encode(a,t[a]));var o=k()(e),r=new Blob([o],{type:"image/png"});n(r)}))}function x(e){for(var t=D()(e).filter((function(e){return"tEXt"===e.name})).map((function(e){return S.a.decode(e.data)})),n={},a=0;a<t.length;a++){var o=t[a];n[o.keyword]=o.text}return n}var L=n(7),C=function(e){return"0".concat(e.toString(16)).slice(-2)},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=new Uint8Array(e/2);return crypto.getRandomValues(t),Array.from(t,C).join("")},M=function e(t){var n=t.parentNode,a=t.timestamp,o=t.operation,r=t.name,i=t.id;Object(m.a)(this,e),this.parentNode=n,this.childNodes=[],this.timestamp=null!==a&&void 0!==a?a:Date.now(),this.operation=o,this.name=r,this.id=null!==i&&void 0!==i?i:P()},R=n(11);function H(e,t){var n=t.currentHistoryNode,a=t.redos,o=t.undos,r=n,i=a.size>0?[a.first()].concat(Object(L.a)(F(a.first()))):[r].concat(Object(L.a)(F(r))),c=F(e);o=new w.List(Object(L.a)(c).reverse()),a=new w.List;for(var s=e;s.childNodes.length>0;){var l=Object(L.a)(s.childNodes);l.sort((function(e,t){return i.indexOf(e)>-1?-1:i.indexOf(t)>-1?1:0})),s=l[0],a=a.unshift(s)}return{currentHistoryNode:e,undos:o,redos:a}}function F(e){var t=[];for(e=e.parentNode;e;e=e.parentNode)t.push(e);return t}function T(e){var t=function(e){for(;e.parentNode;)e=e.parentNode;return e}(e),n=[];return function e(t){var a,o=Object(R.a)(t.childNodes);try{for(o.s();!(a=o.n()).done;){e(a.value)}}catch(r){o.e(r)}finally{o.f()}n.push(t)}(t),n.sort((function(e,t){return e.timestamp<t.timestamp?-1:t.timestamp<e.timestamp?1:0})),n}function B(e){var t=e.palette,n=e.selectedSwatch,a=e.selectedTool,o=e.undos,r=e.redos,i=e.currentHistoryNode,c=T(i),s=function(e){return e.id},l={};return c.forEach((function(e){var t;l[e.id]={parentHNID:e.parentNode&&e.parentNode.id,childHNIDs:e.childNodes.map(s),timestamp:e.timestamp,operation:e.operation&&(t=e.operation,{id:t.id,toolID:t.tool.name,points:t.points,swatch:t.swatch}),name:e.name,id:e.id}})),{format:"mopaint",formatVersion:.5,palette:t,selectedSwatch:n,selectedToolID:a.name,historyNodesByID:l,undoHNIDs:o.toJS().map(s),redoHNIDs:r.toJS().map(s),currentHNID:s(i)}}var z=function(e,t,n,a,o,r){e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.strokeStyle=r,e.lineWidth=5,e.lineCap="round",e.stroke()},U=z,V=function(e,t,n,a,o,r){var i=Math.hypot(a-t,o-n);e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fillStyle=r,e.fill()},A=V,W=function(e,t,n,a,o,r){e.beginPath(),e.rect(t,n,a-t,o-n),e.fillStyle=r,e.fill()};var J=function(e,t,n,a){return[{x:e,y:t},function(e,t){return{x:2*n-e,y:t}}(e,t)]},G=function(e,t,n,a){for(var o=e-n,r=a-t,i=Math.hypot(o,r),c=Math.atan2(o,r)+0,s=[],l=0;l<6;l++){var u=c+2*Math.PI/6*l;e=n+Math.sin(u)*i,t=a-Math.cos(u)*i,s.push({x:e,y:t})}return s};function q(){return(q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Y(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var _=s.a.createElement("g",null),X=s.a.createElement("g",null),$=s.a.createElement("g",null),K=s.a.createElement("g",null),Q=s.a.createElement("g",null),Z=s.a.createElement("g",null),ee=s.a.createElement("g",null),te=s.a.createElement("g",null),ne=s.a.createElement("g",null),ae=s.a.createElement("g",null),oe=s.a.createElement("g",null),re=s.a.createElement("g",null),ie=s.a.createElement("g",null),ce=s.a.createElement("g",null),se=s.a.createElement("g",null),le=function(e){var t=e.svgRef,n=e.title,a=Y(e,["svgRef","title"]);return s.a.createElement("svg",q({id:"Capa_1",x:"0px",y:"0px",viewBox:"0 0 18.713 18.713",style:{enableBackground:"new 0 0 18.713 18.713"},xmlSpace:"preserve",ref:t},a),n?s.a.createElement("title",null,n):null,s.a.createElement("g",{transform:"scale(-1,1) translate(-18.713,0)"},s.a.createElement("path",{style:{fill:"#030104"},d:"M13.367,6.434L8.872,1.895l-0.65-0.672L6.687,2.731c-2.624-0.375-4.51,0.59-5.178,1.777 C0.698,5.949,1.527,7.522,1.553,7.57c0.693,1.385,1.689,2.216,2.961,2.473c0.279,0.055,0.56,0.08,0.84,0.08 c1.322,0,2.644-0.561,3.649-1.135c0.271,0.188,0.601,0.299,0.954,0.299c0.93,0,1.686-0.759,1.686-1.691s-0.756-1.69-1.686-1.69 s-1.686,0.758-1.686,1.69c0,0.093,0.013,0.184,0.027,0.274C7.286,8.445,5.951,8.986,4.77,8.748C3.905,8.573,3.237,7.995,2.719,6.96 C2.714,6.95,2.203,5.957,2.654,5.157c0.38-0.676,1.371-1.111,2.883-1.275L5.302,4.119L3.13,6.299 c0.023,0.053,0.04,0.085,0.041,0.087c0.209,0.418,0.444,0.758,0.706,1.03l3.932-3.943c0.187-0.187,0.435-0.29,0.698-0.29 s0.513,0.103,0.698,0.29l4.771,4.787c0.385,0.385,0.385,1.014,0,1.399L7.774,15.88c-0.372,0.373-1.023,0.373-1.396,0l-4.772-4.787 c-0.187-0.186-0.289-0.434-0.289-0.699c0-0.264,0.102-0.514,0.289-0.7l0.515-0.518C1.828,8.874,1.568,8.512,1.335,8.098 l-0.66,0.663C0.24,9.197,0,9.777,0,10.394c0,0.617,0.24,1.197,0.675,1.633l4.772,4.787c0.435,0.436,1.012,0.676,1.628,0.676 c0.614,0,1.193-0.24,1.628-0.676l6.201-6.221L16.205,9.3l-0.361-0.365c0.683-0.373,0.987,2.744,0.987,2.744s0.954,7.439,1.802,0 C19.443,4.56,13.854,6.272,13.367,6.434z"})),_,X,$,K,Q,Z,ee,te,ne,ae,oe,re,ie,ce,se)},ue=s.a.forwardRef((function(e,t){return s.a.createElement(le,q({svgRef:t},e))})),de=(n.p,{"Freeform Line":{name:"Freeform Line",drawFromPoints:function(e,t,n){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var a=1;a<t.length;a+=1)e.lineTo(t[a].x,t[a].y);e.strokeStyle=n,e.lineWidth=5,e.lineCap="round",e.lineJoin="round",e.stroke()}},Line:{drawShape:U},"Freeform Circles":{drawSegmentOfPath:A},Circle:{drawShape:A},Rectangle:{drawShape:W},Fill:{Icon:ue,drawFromPoint:function(e,t,n,a,o){e.drawImage(o.canvas,0,0),function(e,t,n,a){var o=e.canvas;if(t=Math.floor(t),n=Math.floor(n),!(t<0||n<0||t>o.width||n>o.height)){var r=[[t,n]],i=e.getImageData(0,0,o.width,o.height),c=4*(n*o.width+t),s=i.data[c+0],l=i.data[c+1],u=i.data[c+2],d=i.data[c+3],m=document.createElement("canvas").getContext("2d");m.fillStyle=a,m.fillRect(0,0,1,1);var f=m.getImageData(0,0,1,1),p=Object(h.a)(f.data,4),v=p[0],g=p[1],w=p[2],y=p[3];if(v!==s||g!==l||w!==u||y!==d){for(;r.length;){var b,E,O=void 0,D=void 0,N=void 0,k=void 0;for(E=(b=r.pop())[0],D=4*((O=b[1])*o.width+E);I(D);)D=4*(--O*o.width+E);for(N=!1,k=!1;D=4*(++O*o.width+E),O<o.height&&I(D);)S(D),E>0&&(I(D-4)?N||(r.push([E-1,O]),N=!0):N&&(N=!1)),E<o.width-1&&(I(D+4)?k||(r.push([E+1,O]),k=!0):k&&(k=!1)),D+=4*o.width}e.putImageData(i,0,0)}}function I(e){return i.data[e+0]===s&&i.data[e+1]===l&&i.data[e+2]===u&&i.data[e+3]===d}function S(e){i.data[e+0]=v,i.data[e+1]=g,i.data[e+2]=w,i.data[e+3]=y}}(e,t,n,a)}}});Object.keys(de).forEach((function(e){var t=de[e];t.drawSegmentOfPath&&(t.drawFromPoints=function(e,n,a){for(var o=0,r=1;r<n.length;o+=1,r+=1)t.drawSegmentOfPath(e,n[o].x,n[o].y,n[r].x,n[r].y,a)},t.getDemoPointsForIcon=function(e,t){for(var n=[],a=0;a<20;a+=2)n.push({x:e/2+48*Math.sin(Math.sin(a*a/302)),y:t/2+48*Math.cos(Math.sin(a/5))});return n}),t.drawShape&&(t.drawFromPoints=function(e,n,a){var o=n[0],r=n[n.length-1];t.drawShape(e,o.x,o.y,r.x,r.y,a)},t.getDemoPointsForIcon=function(e,t){return[{x:.5*e,y:.5*t},{x:.8*e,y:.8*t}]}),t.drawFromPoint&&(t.drawFromPoints=function(e,n,a,o){var r=n[n.length-1];t.drawFromPoint(e,r.x,r.y,a,o)},t.getDemoPointsForIcon=function(e,t){return{x:e/2,y:t/2}}),t.getDemoPointsForIcon||(t.getDemoPointsForIcon=function(e,t){for(var n=[],a=0;a<20;a+=2)n.push({x:e/2+48*Math.sin(Math.sin(a*a/302)),y:t/2+48*Math.cos(Math.sin(a/5))});return n})})),[{prefix:"Mirror Symmetric ",pointToPoints:J},{prefix:"Rotationally Symmetric ",pointToPoints:G}].forEach((function(e){Object.keys(de).forEach((function(t){var n=de[t],a=e.prefix+t;if(!n.drawFromPoint&&n.drawFromPoints){var o=de[a]={};if(o.drawFromPoints=function(t,a,o,r){var i,c=[],s=t.canvas.width/2,l=t.canvas.height/2,u=Object(R.a)(a);try{for(u.s();!(i=u.n()).done;)for(var d=i.value,h=e.pointToPoints(d.x,d.y,s,l),m=0;m<h.length;m++)c[m]=c[m]||[],c[m].push(h[m])}catch(g){u.e(g)}finally{u.f()}for(var f=0,p=c;f<p.length;f++){var v=p[f];n.drawFromPoints(t,v,o,r)}},n.getSymmetryPoints){var r=n.getSymmetryPoints;o.getSymmetryPoints=function(t,n){var a=r(t,n),o=t.canvas.width/2,i=t.canvas.height/2;return a.map((function(t){return e.pointToPoints(t.x,t.y,o,i)})).flat()}}else o.getSymmetryPoints=function(t,n){var a=t.canvas.width/2,o=t.canvas.height/2;return e.pointToPoints(n.x,n.y,a,o)};o.getDemoPointsForIcon=function(e,t){return n.getDemoPointsForIcon(e/2,t/2)}}}))}));var he=Object.keys(de).map((function(e){var t=de[e];return t.name=e,t})),me=de,fe=(n(68),n(30)),pe=n.n(fe),ve=document.createElement("canvas"),ge=ve.getContext("2d");n(72);function we(){return s.a.createElement("div",{className:"LoadingIndicator",role:"progressbar"})}var ye=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).operation=null,a.pointerPos=null,a.pointerOverCanvas=!1,a.canvasRef=s.a.createRef(),a.cache={},a.hashInDocumentByOperation=new Map,a}return Object(f.a)(n,[{key:"draw",value:function(){var e=this;this.animationFrameID&&cancelAnimationFrame(this.animationFrameID),this.animationFrameID=requestAnimationFrame((function(){if(function(e){var t=e.documentCanvas,n=e.operations,a=(e.thumbnailsByOperation,e.cache),o=e.hashInDocumentByOperation,r=t.getContext("2d");r.clearRect(0,0,ve.width,ve.height),ve.width=t.width,ve.height=t.height;for(var i=-1/0,c=n.length-1;c>=0;c--){var s=n[c],l=o.get(s);if(a["document-at-".concat(l)]){r.drawImage(a["document-at-".concat(l)],0,0),i=c;break}}c++;for(var u=pe()();c<n.length;c++){var d=n[c];u.update(JSON.stringify(d));var h=u.digest("hex");if(ge.clearRect(0,0,ve.width,ve.height),a["individual-".concat(h)])r.drawImage(a["individual-".concat(h)],0,0),i=c;else{var m=d.points,f=d.tool,p=d.swatch;f.drawFromPoints(ge,m,p,r),r.drawImage(ve,0,0),o.set(d,h),d.updatingContinously||c>=i+5&&(a["document-at-".concat(h)]=document.createElement("canvas"),a["document-at-".concat(h)].width=ve.width,a["document-at-".concat(h)].height=ve.height,a["document-at-".concat(h)].getContext("2d").drawImage(t,0,0),i=c)}}}({documentCanvas:e.canvasRef.current,operations:e.props.operations,thumbnailsByOperation:e.props.thumbnailsByOperation,cache:e.cache,hashInDocumentByOperation:e.hashInDocumentByOperation}),(e.pointerOverCanvas||e.operation)&&e.props.selectedTool.getSymmetryPoints&&e.pointerPos){var t,n=e.canvasRef.current.getContext("2d"),a=e.props.selectedTool.getSymmetryPoints(n,e.pointerPos),o=Object(R.a)(a);try{for(o.s();!(t=o.n()).done;){var r=t.value;n.beginPath(),n.arc(r.x,r.y,2.5,0,2*Math.PI),n.fillStyle="#fff",n.fill(),n.strokeStyle="#000",n.lineWidth=1,n.stroke()}}catch(i){o.e(i)}finally{o.f()}}}))}},{key:"render",value:function(){this.draw();return s.a.createElement("div",{className:"DrawingCanvas",style:{width:640,height:480,position:"relative"}},s.a.createElement("canvas",{width:640,height:480,ref:this.canvasRef}),!this.props.loaded&&s.a.createElement("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},s.a.createElement(we,null)))}},{key:"toCanvasCoords",value:function(e){var t=this.canvasRef.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}},{key:"onPointerMove",value:function(e){this.pointerPos=this.toCanvasCoords(e),this.props.selectedTool.getSymmetryPoints&&this.draw()}},{key:"onPointerLeave",value:function(e){this.pointerOverCanvas=!1,this.props.selectedTool.getSymmetryPoints&&this.draw()}},{key:"onPointerEnter",value:function(e){this.pointerOverCanvas=!0}},{key:"onPointerMoveWhileDown",value:function(e){(e.preventDefault(),this.pointerPos=this.toCanvasCoords(e),this.operation)&&(this.operation.points.push(this.pointerPos),(0,this.props.updateOperation)(this.operation))}},{key:"onPointerDown",value:function(e){if(1===e.which){e.preventDefault();var t=this.props,n=t.selectedSwatch,a=t.selectedTool;if(a)this.pointerPos=this.toCanvasCoords(e),this.operation={id:P(10),points:[this.pointerPos],tool:a,swatch:n,updatingContinously:!0},(0,this.props.addOperation)(this.operation),e.target.setCapture?e.target.setCapture():document.body.classList.add("cursor-override-DrawingCanvas");else console.warn("no tool selected")}}},{key:"onPointerUp",value:function(e){var t=this.props.updateOperation;this.operation&&(delete this.operation.updatingContinously,t(this.operation),this.operation=null,document.body.classList.remove("cursor-override-DrawingCanvas"))}},{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current,n=!1;t.addEventListener("pointermove",this.pointerMoveListener=function(t){e.onPointerMove(t)}),t.addEventListener("pointerleave",this.pointerLeaveListener=function(t){e.onPointerLeave(t)}),t.addEventListener("pointerenter",this.pointerEnterListener=function(t){e.onPointerEnter(t)}),t.addEventListener("pointerdown",this.pointerDownListener=function(t){n||0===t.button&&(n=!0,e.onPointerDown(t),window.addEventListener("pointermove",e.pointerMoveWhileDownListener=function(t){e.onPointerMoveWhileDown(t)}),window.addEventListener("pointerup",e.pointerUpListener=function(t){window.removeEventListener("pointermove",e.pointerMoveWhileDownListener),window.removeEventListener("pointerup",e.pointerUpListener),n=!1,e.onPointerUp(t)}))})}},{key:"componentWillUnmount",value:function(){var e=this.canvasRef.current;e.removeEventListener("pointerdown",this.pointerDownListener),e.removeEventListener("pointermove",this.pointerMoveListener),e.removeEventListener("pointerleave",this.pointerLeaveListener),e.removeEventListener("pointerenter",this.pointerEnterListener),window.removeEventListener("pointermove",this.pointerMoveWhileDownListener),window.removeEventListener("pointerup",this.pointerUpListener),cancelAnimationFrame(this.animationFrameID)}}]),n}(c.Component),be=function(){function e(e,t,n){for(var a=0;a<t;++a)if(0!==e.data[n*t*4+4*a+3])return!1;return!0}function t(e,t,n,a,o){for(var r=a;r<o;++r)if(0!==e.data[r*t*4+4*n+3])return!1;return!0}return function(n){for(var a=n.getContext("2d"),o=n.width,r=a.getImageData(0,0,n.width,n.height),i=0,c=r.height,s=0,l=r.width;i<c&&e(r,o,i);)++i;for(;c-1>i&&e(r,o,c-1);)--c;for(;s<l&&t(r,o,s,i,c);)++s;for(;l-1>s&&t(r,o,l-1,i,c);)--l;var u=a.getImageData(s,i,l-s||1,c-i||1),d=n.ownerDocument.createElement("canvas"),h=d.getContext("2d");return d.width=u.width,d.height=u.height,h.putImageData(u,0,0),d}}(),Ee=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,a=e.tool;return a.Icon?s.a.createElement(a.Icon,{className:"ToolPreview",width:t,height:n}):s.a.createElement("canvas",{className:"ToolPreview",width:t,height:n,ref:"canvas"})}},{key:"componentDidMount",value:function(){var e=u.a.findDOMNode(this.refs.canvas);if(e){var t=e.getContext("2d"),n=document.createElement("canvas");n.width=128,n.height=128;var a=n.getContext("2d"),o=this.props.tool,r=o.getDemoPointsForIcon(n.width,n.height);o.drawFromPoints(a,r,"black");var i,c,s=be(n);s.width>s.height?(i=e.width,c=s.height/s.width*e.width):(i=s.width/s.height*e.width,c=e.width),t.drawImage(s,(e.width-i)/2,(e.height-c)/2,i,c)}}}]),n}(c.Component),Oe=(n(73),function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.tools,n=e.selectedTool,a=e.selectTool;return t=t||[],s.a.createElement("div",{className:"Toolbox",role:"radiogroup"},t.map((function(e){var t=n===e;return s.a.createElement("button",{key:e.name,className:"Toolbox-tool",role:"radio","aria-checked":t?"aria-checked":null,onClick:function(){a(e)},title:e.name},s.a.createElement(Ee,{tool:e,width:48,height:48}))})))}}]),n}(c.Component)),De=(n(74),function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.palette,n=e.selectedSwatch,a=e.selectSwatch;return s.a.createElement("div",{className:"Palette",role:"radiogroup"},t.map((function(e){var t=n===e;return s.a.createElement("button",{key:e,className:"Palette-swatch swatch",style:{backgroundColor:e},role:"radio","aria-checked":t?"aria-checked":null,onClick:function(){a(e)}})})))}}]),n}(c.Component)),Ne=(n(75),function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.palette,n=e.selectedSwatch,a=e.selectSwatch;return s.a.createElement("div",{className:"Colorbox"},s.a.createElement("div",{className:"Colorbox-selected-swatches"},s.a.createElement("div",{className:"Colorbox-selected-swatch swatch",key:n,style:{backgroundColor:n}})),s.a.createElement("div",{className:"Colorbox-divider"}),s.a.createElement(De,{palette:t,selectedSwatch:n,selectSwatch:a}))}}]),n}(c.Component));n(76);c.Component;var ke=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"shouldComponentUpdate",value:function(e){return e.current!==this.props.current||e.historyNode!==this.props.historyNode||e.ancestorOfCurrent!==this.props.ancestorOfCurrent}},{key:"render",value:function(){var e,t=this.props,n=t.current,a=t.ancestorOfCurrent,o=t.onClick,r=t.historyNode,i=t.getIconReactElementMaybe,c=r.operation;return s.a.createElement("button",{className:"HistoryEntry"+(n?" current":"")+(a?" ancestor-of-current":""),role:"radio","aria-checked":n?"aria-checked":null,onClick:o,onMouseDown:o},null!==(e=null===i||void 0===i?void 0:i())&&void 0!==e?e:c&&s.a.createElement(Ee,{tool:c.tool,width:16,height:16}),r.name)}}]),n}(c.Component);n(77);function Ie(){return(Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Se(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var je=s.a.createElement("path",{fill:"#95a5a6",d:"M5 0c-.982 0-3 2.018-3 3v10c0 1 1 2 2 2h8c.982 0 .762-1.048 1-2V5L9 0z"}),xe=s.a.createElement("path",{fill:"#bdc3c7",d:"M4 0c-.982 0-2 1.018-2 2v10c0 .982 1.018 2 2 2h8c.982 0 1.73-1.056 2-2V5L9 0z"}),Le=s.a.createElement("path",{fill:"#95a5a6",d:"M14 5L9 0v3c0 .982 1.018 2 2 2z"}),Ce=s.a.createElement("g",{transform:"matrix(.5 0 0 .5 9.225 -504.681)"},s.a.createElement("circle",{cx:6.55,cy:1034.362,r:7,fill:"#27ae60"}),s.a.createElement("circle",{cx:6.55,cy:1032.362,r:7,fill:"#2ecc71"}),s.a.createElement("path",{fill:"#27ae60",d:"M1.55 1035.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z"}),s.a.createElement("path",{fill:"#ecf0f1",d:"M1.55 1033.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z"})),Pe=function(e){var t=e.svgRef,n=e.title,a=Se(e,["svgRef","title"]);return s.a.createElement("svg",Ie({width:16,height:16,viewBox:"0 0 16 16",ref:t},a),n?s.a.createElement("title",null,n):null,je,xe,Le,Ce)},Me=s.a.forwardRef((function(e,t){return s.a.createElement(Pe,Ie({svgRef:t},e))})),Re=(n.p,function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).currentEntryRef=s.a.createRef(),a.selfRef=s.a.createRef(),a}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.scrollSelectedEntryIntoView()}},{key:"componentDidUpdate",value:function(e){this.props.undos.size!==e.undos.size&&this.scrollSelectedEntryIntoView()}},{key:"scrollSelectedEntryIntoView",value:function(){var e=this.currentEntryRef.current&&u.a.findDOMNode(this.currentEntryRef.current);e&&e.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}},{key:"shouldComponentUpdate",value:function(e){return e.currentHistoryNode!==this.props.currentHistoryNode||e.thumbnailsByOperation!==this.props.thumbnailsByOperation||e.loaded!==this.props.loaded}},{key:"render",value:function(){var e=this,t=this.props,n=t.currentHistoryNode,a=t.goToHistoryNode,o=t.thumbnailsByOperation,r=t.loaded,i=F(n),c=T(n),l=function(e){var t=c.indexOf(n),o=c[t+e];o&&a(o)};return s.a.createElement("div",{className:"HistoryView",role:"radiogroup",ref:this.selfRef,onKeyDown:function(e){"ArrowUp"===e.key?(e.preventDefault(),l(-1)):"ArrowDown"===e.key&&(e.preventDefault(),l(1))}},r?c.map((function(t){var r=i.indexOf(t)>-1,c=t===n;return s.a.createElement(ke,{key:t.id,historyNode:t,current:c,ref:c&&e.currentEntryRef,ancestorOfCurrent:r,onClick:function(){return a(t)},thumbnailsByOperation:o,getIconReactElementMaybe:function(){return"New Document"===t.name?s.a.createElement(Me,{width:16,height:16}):null}})})):s.a.createElement(we,null))}}]),n}(c.Component)),He=(n(78),function(e){return s.a.createElement("a",{href:"https://github.com/1j01/mopaint/issues/",target:"_blank",rel:"noopener noreferrer"},e.children)});function Fe(e){var t=e.message,n=e.error,a=(e.isError,e.requestBugReport),o=e.close,r=e.extraButtons,i=e.buttons,c=e.maxWidth,l=void 0===c?"50em":c,u=n&&n.stack&&(0===n.stack.indexOf(n.toString())?n.stack.slice(n.toString().length).trimEnd():"\n".concat(n.stack.trim()).replace(/\n/g,"\n    ")),d=n&&(u?"".concat(n.toString(),"\n\nStack trace:").concat(u):n.toString());return s.a.createElement("div",{className:"Dialog"},s.a.createElement("div",{className:"Dialog-box",style:{maxWidth:l}},t||n.message,n&&s.a.createElement("details",null,s.a.createElement("summary",null,"Details"),s.a.createElement("div",{className:"actual-details"},s.a.createElement("pre",null,d))),a&&s.a.createElement("div",null,"You should ",s.a.createElement(He,null,"report this bug"),"."),s.a.createElement("div",{className:"Dialog-buttons"},i||s.a.createElement("button",{onClick:o},"Close"),r)))}n(79);var Te=function(e){return s.a.createElement("div",{className:"Warning"},e.children)},Be=["rgb(174, 206, 209)","rgb(122, 148, 168)","rgb(77, 94, 118)","rgb(44, 47, 75)","rgb(0, 0, 0)","rgb(47, 19, 80)","rgb(113, 31, 133)","rgb(204, 63, 200)","rgb(255, 147, 217)","rgb(255, 255, 255)","rgb(145, 242, 251)","rgb(73, 155, 224)","rgb(44, 78, 167)","rgb(25, 33, 113)","rgb(19, 15, 60)","rgb(35, 48, 90)","rgb(47, 91, 112)","rgb(47, 148, 125)","rgb(53, 213, 75)","rgb(171, 255, 55)","rgb(255, 239, 83)","rgb(243, 162, 20)","rgb(226, 98, 39)","rgb(162, 41, 62)","rgb(91, 26, 58)","rgb(35, 3, 33)","rgb(62, 19, 38)","rgb(139, 60, 60)","rgb(205, 115, 73)","rgb(255, 191, 147)"];n(80);function ze(){return(ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ue(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Ve=s.a.createElement("path",{d:"M7 0c-.982 0-3 2.018-3 3v16c0 1 1 2 2 2h12c.982 0 1-1.018 1-2V5l-4-5z",fill:"#95a5a6"}),Ae=s.a.createElement("path",{d:"M6 0c-.982 0-2 1.018-2 2v16c0 .982 1.018 2 2 2h12c.982 0 2-1.018 2-2V5l-5-5z",fill:"#bdc3c7"}),We=s.a.createElement("path",{d:"M20 5l-5-5v3c0 .982 1.03 1.845 2 2z",fill:"#95a5a6"}),Je=s.a.createElement("g",{transform:"matrix(.5 0 0 .5 16.225 -497.681)"},s.a.createElement("circle",{cx:6.55,cy:1034.362,r:9,fill:"#27ae60"}),s.a.createElement("circle",{cx:6.55,cy:1032.362,r:9,fill:"#2ecc71"}),s.a.createElement("path",{d:"M1.55 1035.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z",fill:"#27ae60"}),s.a.createElement("path",{d:"M1.55 1033.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z",fill:"#ecf0f1"})),Ge=function(e){var t=e.svgRef,n=e.title,a=Ue(e,["svgRef","title"]);return s.a.createElement("svg",ze({width:24,height:24,viewBox:"0 0 24 24",ref:t},a),n?s.a.createElement("title",null,n):null,Ve,Ae,We,Je)},qe=s.a.forwardRef((function(e,t){return s.a.createElement(Ge,ze({svgRef:t},e))}));n.p;function Ye(){return(Ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Xe=s.a.createElement("path",{d:"M1.632 6.314C.73 6.314 0 7.044 0 7.946v11.422C0 20.27.78 21 1.682 21H17.75c1.401 0 2.281-2.21 2.253-2.42l-.422-.549V7.946c0-.902-.73-1.632-1.631-1.632z",fill:"#2980b9"}),$e=s.a.createElement("path",{d:"M3 3c-.901 0-2 1.099-2 2v10.928c0 1 .546 1.808 1.448 1.808H17.134c.901 0 1.632-.73 1.632-1.631V6.532C18.766 5.633 17.9 5 17 5H10.473L8 3z",fill:"#2980b9"}),Ke=s.a.createElement("path",{d:"M18.52 19.368L20 8c.118-.909-.203-2-1.203-2H4c-.901 0-1.42.229-1.557 1.13L1 19z",fill:"#bdc3c7"}),Qe=s.a.createElement("path",{d:"M6 7c-.901 0-1.362.044-1.68.946L2.591 12.84l-.288.816L1 18c-.318.901 0 2 2 2h15.14c.902 0 1.34-.156 1.799-1.12l1.946-5.223.288-.816 1.463-4.32c.428-1.1.172-1.521-.972-1.521z",fill:"#3498db"}),Ze=function(e){var t=e.svgRef,n=e.title,a=_e(e,["svgRef","title"]);return s.a.createElement("svg",Ye({width:24,height:24,viewBox:"0 0 24 24",ref:t},a),n?s.a.createElement("title",null,n):null,Xe,$e,Ke,Qe)},et=s.a.forwardRef((function(e,t){return s.a.createElement(Ze,Ye({svgRef:t},e))}));n.p;function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function nt(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var at=s.a.createElement("path",{d:"M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-3H5z",fill:"#3498db"}),ot=s.a.createElement("path",{d:"M7 3v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3H7z",fill:"#2980b9"}),rt=s.a.createElement("path",{d:"M7 3v5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3H7zM6 12a1 1 0 0 0-1 1v8h14v-8a1 1 0 0 0-1-1H6z",fill:"#ecf0f1"}),it=s.a.createElement("path",{fill:"#bdc3c7",d:"M5 20h14v1H5zM7 14h10v1H7zM7 16h10v1H7z"}),ct=s.a.createElement("path",{fill:"#3498db",d:"M13 4h3v4h-3z"}),st=s.a.createElement("path",{fill:"#2980b9",d:"M13 4h3v1h-3z"}),lt=function(e){var t=e.svgRef,n=e.title,a=nt(e,["svgRef","title"]);return s.a.createElement("svg",tt({width:24,height:24,viewBox:"0 0 24 24",ref:t},a),n?s.a.createElement("title",null,n):null,at,ot,rt,it,ct,st)},ut=s.a.forwardRef((function(e,t){return s.a.createElement(lt,tt({svgRef:t},e))}));n.p;function dt(){return(dt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ht(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var mt=s.a.createElement("g",{id:"a"},s.a.createElement("path",{d:"M23 1044.362a2 2 0 01-2 2H7a2 2 0 01-2-2v-10a2 2 0 012-2h14a2 2 0 012 2v4z",fill:"#95a5a6",transform:"translate(3 -1051.362)"}),s.a.createElement("path",{d:"M5 1043.362a2 2 0 002 2h14a2 2 0 002-2v-10a2 2 0 00-2-2H7a2 2 0 00-2 2v4z",fill:"#bdc3c7",transform:"translate(3 -1051.362)"}),s.a.createElement("path",{fill:"#f39c12",d:"M7 1033.362h14v10H7z",transform:"translate(3 -1051.362)"}),s.a.createElement("path",{d:"M16.625 8.625L9 15h12v-2z",transform:"translate(3 -23)",fill:"#e67e22"}),s.a.createElement("path",{d:"M13 1036.362a2.5 2.5 0 11-5 0 2.5 2.5 0 115 0z",fill:"#f1c40f",strokeWidth:1.75,transform:"translate(3 -1051.362)"}),s.a.createElement("path",{d:"M10 1037.362l-3 3.188v2.812h10z",fill:"#d35400",transform:"translate(3 -1051.362)"})),ft=s.a.createElement("use",{x:0,y:0,xlinkHref:"#a",id:"b",transform:"translate(-2 20)",width:"100%",height:"100%"}),pt=s.a.createElement("use",{xlinkHref:"#b",transform:"translate(-3 4)",width:"100%",height:"100%"}),vt=s.a.createElement("use",{xlinkHref:"#b",transform:"translate(-6 8)",width:"100%",height:"100%"}),gt=function(e){var t=e.svgRef,n=e.title,a=ht(e,["svgRef","title"]);return s.a.createElement("svg",dt({width:24,height:24,viewBox:"0 0 24 24",ref:t},a),n?s.a.createElement("title",null,n):null,mt,ft,pt,vt)},wt=s.a.forwardRef((function(e,t){return s.a.createElement(gt,dt({svgRef:t},e))})),yt=(n.p,n(81),function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={name:"Untitled",thumbnailBlobURL:null},e}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.documentID;o.a.getItem("document:".concat(t,":name")).then((function(t){t&&e.setState({name:t})})),o.a.getItem("document:".concat(t,":thumbnail")).then((function(t){t&&e.setState({thumbnailBlobURL:URL.createObjectURL(t)})}))}},{key:"componentWillUnmount",value:function(){URL.revokeObjectURL(this.state.thumbnailBlobURL)}},{key:"render",value:function(){var e=this.props.documentID;return s.a.createElement("a",{href:"?document=".concat(e)},s.a.createElement("div",{className:"document-thumbnail"},s.a.createElement("img",{src:this.state.thumbnailBlobURL,alt:""})),this.state.name||"Untitled")}}]),n}(s.a.Component)),bt=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).state={documentIDs:null},a}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=function(){return o.a.keys().then((function(t){var n=t.map((function(e){return e.match(/document:([a-zA-Z0-9\-_]+):state/)})).filter((function(e){return e})).map((function(e){return e[1]}));(n=[e.props.currentDocumentID].concat(Object(L.a)(n.filter((function(t){return t!==e.props.currentDocumentID}))))).sort(),e.setState({documentIDs:n})}))};t(),this.iid=setInterval(t,600)}},{key:"componentWillUnmount",value:function(){clearInterval(this.iid)}},{key:"render",value:function(){var e="Loading documents list...";this.state.documentIDs&&(e=this.state.documentIDs.map((function(e){return s.a.createElement("li",{"data-document-id":e,key:e},s.a.createElement(yt,{documentID:e}))})));return s.a.createElement(Fe,{maxWidth:"",message:s.a.createElement("div",{className:"document-picker-dialog-message"},s.a.createElement("ul",{className:"document-picker-dialog-documents"},e)),close:this.props.close})}}]),n}(s.a.Component);n(82);function Et(){try{if("dark"===localStorage["mopaint-color-scheme"])return"dark";if("light"===localStorage["mopaint-color-scheme"])return"light"}catch(e){}return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Ot(){return Object(c.useLayoutEffect)((function(){document.documentElement.setAttribute("data-color-scheme",Et())})),s.a.createElement("button",{className:"dark-mode-button","aria-label":"Toggle Dark Mode",onClick:function(){localStorage["mopaint-color-scheme"]="light"===Et()?"dark":"light",document.documentElement.setAttribute("data-color-scheme",Et())}},s.a.createElement("div",{className:"rays"},s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"}),s.a.createElement("div",{className:"ray"})),s.a.createElement("div",{className:"sun-moon"},s.a.createElement("div",{className:"shadow"})))}var Dt=function(e){var t=me[e];if(!t)throw new Error("Tool not found with name '".concat(e,"'"));return t},Nt=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(e){var a;Object(m.a)(this,n),(a=t.call(this,e)).state={palette:Be,selectedSwatch:"rgb(0, 0, 0)",selectedTool:Dt("Freeform Line"),undos:new w.List,redos:new w.List,currentHistoryNode:new M({name:"New Document"}),loaded:!1,loadFailed:!1},a.thumbnailsByOperation=new Map,a.timeoutIDs=new Set;return a.saveDebounced=function(e,t){var n;return function(){clearTimeout(n),a.timeoutIDs.delete(n),n=setTimeout(e,t),a.timeoutIDs.add(n)}}(a.save.bind(Object(p.a)(a)),500),a}return Object(f.a)(n,[{key:"loadSerializedDocument",value:function(e,t){var n,a,r=this;try{var i=function(e,t,n){var a=t?"document":"document state";if("mopaint"!==e.format)return[{message:"Can't load ".concat(a," - it does not appear to be a Mopaint document")}];if("number"!==typeof e.formatVersion||e.formatVersion>.5)return[{message:"Can't load ".concat(a," created by later version of the app")}];if(.1===e.formatVersion&&(e.formatVersion=.3),.3===e.formatVersion){e.formatVersion=.4;var o=+new Date("January 1, 2020 00:00:00"),r={name:"New Document",id:P(),childHNIDs:[],timestamp:o},i={};i[r.id]=r;var c,l=new Map,u=function(e){var t=P();i[t]={id:t,operation:e,name:e.toolID,parentHNID:void 0,childHNIDs:[],timestamp:o},l.set(e,i[t])};e.undos.forEach(u),e.redos.forEach(u);var d=[],m=[],f=[].concat(Object(L.a)(e.undos),Object(L.a)(Object(L.a)(e.redos).reverse()));[r].concat(Object(L.a)(f.map((function(e){return l.get(e)})))).forEach((function(e,t,n){var a,o,r=n[t-1];r&&(o=e,(a=r)&&(a.childHNIDs.push(o.id),o.parentHNID=a.id)),e.timestamp+=t})),d.push(r.id),f.forEach((function(t){var n=l.get(t);t===e.undos[e.undos.length-1]?c=n.id:e.redos.indexOf(t)>-1?m.push(n.id):d.push(n.id)})),e.historyNodesByID=i,e.currentHNID=c,e.undoHNIDs=d,e.redoHNIDs=m,delete e.undos,delete e.redos}if(.4===e.formatVersion){e.formatVersion=.5;for(var p=0,v=Object.values(e.historyNodesByID);p<v.length;p++){var g,y=v[p];if("Fill"===(null===(g=y.operation)||void 0===g?void 0:g.name))y.operation.points.length=1}}if(e.formatVersion<.5){var b="format-version-".concat(e.formatVersion);return[{message:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Can't load ",a," created by old version of the app; there's no upgrade path from format version ",e.formatVersion," to ",.5," (minimum loadable: ".concat(.1,")")),s.a.createElement("p",null,"To load this ",a,", use the version of Mopaint at the Git branch\xa0",s.a.createElement("a",{href:"https://github.com/1j01/mopaint/tree/".concat(b),style:{fontFamily:"monospace"}},b)))}]}var E=function(e,t,n){e.forEach((function(e){if(!t[e])throw new TypeError("expected property '".concat(e,"' ").concat(n))}))},O=function(e){E(["id","toolID","points","swatch"],e,"on operation with ID ".concat(e.id));var t=n(e.toolID);return{id:e.id,tool:t,points:e.points,swatch:e.swatch}};E(["palette","selectedSwatch","selectedToolID","undoHNIDs","redoHNIDs","currentHNID","historyNodesByID"],e,"on the root document object");for(var D={},N=0,k=Object.entries(e.historyNodesByID);N<k.length;N++){var I=Object(h.a)(k[N],2),S=I[0],j=I[1];D[S]=new M(j),j.operation&&(D[S].operation=O(j.operation))}for(var x=function(e){return D[e]},C=0,R=Object.entries(e.historyNodesByID);C<R.length;C++){var H=Object(h.a)(R[C],2),F=H[0],T=H[1];D[F].parentNode=D[T.parentHNID],D[F].childNodes=T.childHNIDs.map(x)}return[null,{palette:e.palette,selectedSwatch:e.selectedSwatch,selectedTool:n(e.selectedToolID),undos:new w.List(e.undoHNIDs.map(x)),redos:new w.List(e.redoHNIDs.map(x)),currentHistoryNode:x(e.currentHNID)}]}(e,t,Dt),c=Object(h.a)(i,2);n=c[0],a=c[1]}catch(l){n={message:"Failed to load document!",error:l}}n?(this.showError(n),this.setState({loadFailed:!0})):(a.loaded=!0,this.setState(a,(function(){console.log("Loaded ".concat(r.props.documentID)),o.a.getItem("document:".concat(r.props.documentID,":thumbnail")).then((function(e){e||requestAnimationFrame((function(){r.saveThumbnail()}))}))})))}},{key:"load",value:function(){var e=this;if(this.props.documentID){console.log("Load ".concat(this.props.documentID));var t=this.props.serializedDocumentToLoad;o.a.getItem("document:".concat(this.props.documentID,":state"),(function(n,a){if(n)return e.showError({message:"Failed to load document state from storage!",error:n}),void e.setState({loadFailed:!0});if(t)a?e.showError({message:"Almost loaded a document over an existing document. This shouldn't happen!",requestBugReport:!0}):e.loadSerializedDocument(t);else{if(!a)return e.setState({loaded:!0}),void console.log("State loaded as empty for document:".concat(e.props.documentID,":state"));console.log("Loaded data for ".concat(e.props.documentID)),e.loadSerializedDocument(a)}}))}else console.log("No document ID to load")}},{key:"save",value:function(e){var t=this;if(this.state.loaded){var n=B(this.state);o.a.setItem("document:".concat(this.props.documentID,":state"),n,(function(n){var a=e?"the previous document":"document";n?"QuotaExceededError"!==n.name||n.message?"QuotaExceededError"===n.name?t.showError({message:s.a.createElement("div",null,"Failed to save ",a," into storage!",s.a.createElement("br",null),s.a.createElement("br",null),"Ran out of space allowed by the browser. You could free up quota by clearing the storage for this site in your browser's settings, however, this will delete all documents."),error:n}):t.showError({message:"Failed to save ".concat(a," into storage!"),error:n}):t.showError({message:s.a.createElement("div",null,"Failed to save ",a," into storage!",s.a.createElement("br",null),s.a.createElement("br",null),"Check that your computer has enough disk space.",s.a.createElement("br",null),s.a.createElement("br",null),"If you have enough free space, we've run out of space as allowed by the browser per site. You could free up quota by clearing the storage for this site in your browser's settings, however, this will delete all documents."),error:n}):(console.log("Saved ".concat(t.props.documentID).concat(e?" (leaving it)":"")),t.saveThumbnail())}))}else e||(this.setState({undos:new w.List,redos:new w.List,loaded:!1}),this.showError({message:"The document ".concat(this.state.loadFailed?"failed to load":"hasn't loaded yet",". Start a new document?"),extraButtons:s.a.createElement("button",{onClick:this.props.createNewDocument},"New Document")}))}},{key:"saveThumbnail",value:function(){var e=this,t=document.querySelector(".DrawingCanvas canvas"),n=t.width/t.height,a=document.createElement("canvas");a.width=Math.min(100,t.width,t.height*n),a.height=a.width/n,a.getContext("2d").drawImage(t,0,0,a.width,a.height),a.toBlob((function(t){o.a.setItem("document:".concat(e.props.documentID,":thumbnail"),t,(function(e){}))}))}},{key:"createPNGram",value:function(e,t,n){var a=JSON.stringify(e),o={Software:"Mopaint","Mopaint Format Version":e.formatVersion,"Creation Time":(new Date).toUTCString(),"Program Source":a};console.log("Save PNG with metadata",o);this.createRawPNG((function(e){j(e,o,(function(e){!function(e,t,n){var o=new FileReader;o.onload=function(){var e=o.result;x(new Uint8Array(e))["Program Source"]===a?t():n()},o.readAsArrayBuffer(e)}(e,(function(){t(e)}),(function(){n()}))}))}))}},{key:"createRawPNG",value:function(e){document.querySelector(".DrawingCanvas canvas").toBlob(e,"image/png")}},{key:"loadDocumentFromJSON",value:function(e,t){var n;try{n=JSON.parse(e)}catch(a){return void this.showError({message:s.a.createElement("div",null,"Failed to load as Mopaint document, invalid JSON",s.a.createElement("details",null,s.a.createElement("summary",null,"JSON"),s.a.createElement("div",{className:"actual-details"},s.a.createElement("pre",null,e)))),error:a})}this.props.loadNewDocument(n,t)}},{key:"handleDroppedOrOpenedFiles",value:function(e){var t=this,n=e[0];if(n){var a=new FileReader;a.onload=function(){var e=a.result,o=new Uint8Array(e);if(E()(o)){var r=x(o);if(r["Mopaint Format Version"]){var i=r["Program Source"];t.loadDocumentFromJSON(i,n.name)}else t.showError({message:"Loading images is not supported yet (other than Mopaint PNG programs)"})}else if(o[0]==="{".charCodeAt(0)){var c=new FileReader;c.onload=function(){t.loadDocumentFromJSON(c.result)},c.readAsText(n)}else Object(y.loadPalette)(n,(function(e,n){e?t.showError({message:"Failed to load file as a color palette.",error:e}):t.setState({palette:n.map((function(e){return e.toString()}))},t.saveDebounced.bind(t))}))},a.readAsArrayBuffer(n)}}},{key:"openDocument",value:function(){var e=this,t=document.createElement("input");t.type="file",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",(function(){e.handleDroppedOrOpenedFiles(t.files),t.remove()})),t.click()}},{key:"componentDidMount",value:function(){var e=this;this.load(),window.addEventListener("beforeunload",this.beforeUnloadListener=function(t){e.save(!0)}),window.addEventListener("keydown",this.keyDownListener=function(t){if("Escape"!==t.key){if((!document.activeElement||!document.activeElement.matches("input, textarea"))&&t.ctrlKey){if("z"===t.key)e.undo();else if("Z"===t.key||"y"===t.key)e.redo();else if("s"===t.key||"S"===t.key)e.showSaveDialog();else{if("o"!==t.key)return;e.openDocument()}t.preventDefault()}}else e.closeDialog()}),window.addEventListener("dragover",this.dragOverListener=function(e){e.preventDefault()}),window.addEventListener("drop",this.dropListener=function(t){t.preventDefault(),e.handleDroppedOrOpenedFiles(t.dataTransfer.files)})}},{key:"componentWillUnmount",value:function(){this.save(!0),this.timeoutIDs.forEach((function(e){clearTimeout(e)})),window.removeEventListener("beforeunload",this.beforeUnloadListener),window.removeEventListener("keydown",this.keyDownListener),window.removeEventListener("dragover",this.dragOverListener),window.removeEventListener("drop",this.dropListener)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){console.assert(e.documentID===this.props.documentID,"App component is not designed to handle switching documents without reconstruction")}},{key:"addOperation",value:function(e){var t=this.state,n=t.currentHistoryNode,a=t.undos,o=t.redos;o=new w.List,a=a.push(n);var r=new M({parentNode:n,name:e.tool.name,operation:e});n.childNodes.push(r),n=r,this.setState({currentHistoryNode:n,undos:a,redos:o},this.save.bind(this))}},{key:"updateOperation",value:function(e){this.setState({currentHistoryNode:this.state.currentHistoryNode},this.saveDebounced.bind(this))}},{key:"undo",value:function(){var e=this.state,t=function(e){var t=e.currentHistoryNode,n=e.undos,a=e.redos;return n.size<1?{currentHistoryNode:t,undos:n,redos:a}:(a=a.push(t),H(n.last(),{currentHistoryNode:t,undos:n=n.pop(),redos:a}))}({currentHistoryNode:e.currentHistoryNode,undos:e.undos,redos:e.redos});this.setState({currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos},this.saveDebounced.bind(this))}},{key:"redo",value:function(){var e=this.state,t=function(e){var t=e.currentHistoryNode,n=e.undos,a=e.redos;return a.size<1?{currentHistoryNode:t,undos:n,redos:a}:(n=n.push(t),H(a.last(),{currentHistoryNode:t,undos:n,redos:a=a.pop()}))}({currentHistoryNode:e.currentHistoryNode,undos:e.undos,redos:e.redos});this.setState({currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos},this.saveDebounced.bind(this))}},{key:"goToHistoryNode",value:function(e){var t=this.state,n=H(e,{currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos});this.setState({currentHistoryNode:n.currentHistoryNode,undos:n.undos,redos:n.redos},this.saveDebounced.bind(this))}},{key:"render",value:function(){var e=this,t=this.state,n=t.selectedSwatch,a=t.selectedTool,o=t.palette,r=t.currentHistoryNode,i=t.dialog,c=[];return function(e){for(e.operation&&c.push(e.operation);e.parentNode;)(e=e.parentNode).operation&&c.push(e.operation);c.reverse()}(r),s.a.createElement("div",{className:"App"},s.a.createElement("main",null,s.a.createElement(Te,null,"\u26a0 This app is in very early stages of development. There are Big Plans. See the ",s.a.createElement("a",{href:"https://github.com/1j01/mopaint#mopaint",target:"_blank",rel:"noopener noreferrer"},"README on GitHub for more info"),"."),s.a.createElement("div",{id:"documents-options"},s.a.createElement("button",{id:"new-document",className:"toolbar-button",onClick:this.props.createNewDocument,"aria-label":"New Document",title:"New Document"},s.a.createElement(qe,{width:"48px",height:"48px"})),s.a.createElement("button",{id:"save-document",className:"toolbar-button",onClick:function(){e.showSaveDialog()},"aria-label":"Save Document",title:"Save Document"},s.a.createElement(ut,{width:"48px",height:"48px"})),s.a.createElement("button",{id:"open-document",className:"toolbar-button",onClick:function(){e.openDocument()},"aria-label":"Open Document",title:"Open Document"},s.a.createElement(et,{width:"48px",height:"48px"})),s.a.createElement("button",{id:"show-document-picker",className:"toolbar-button",onClick:function(){e.showChooseDocumentDialog()},"aria-label":"Show Documents",title:"Show Documents"},s.a.createElement(wt,{width:"48px",height:"48px"})),s.a.createElement("div",{style:{flex:1}}),s.a.createElement(Ot,null)),s.a.createElement(Oe,{tools:he,selectedTool:a,selectTool:function(t){e.setState({selectedTool:t},e.saveDebounced.bind(e))}}),s.a.createElement(Ne,{palette:o,selectedSwatch:n,selectSwatch:function(t){e.setState({selectedSwatch:t},e.saveDebounced.bind(e))}}),s.a.createElement(ye,{loaded:this.state.loaded||this.state.loadFailed,selectedSwatch:n,selectedTool:a,documentContext:this.documentContext,addOperation:this.addOperation.bind(this),updateOperation:this.updateOperation.bind(this),operations:c,thumbnailsByOperation:this.thumbnailsByOperation,ref:function(t){e.drawingCanvasComponent=t}})),s.a.createElement("div",{className:"sidebar"},s.a.createElement(Re,{loaded:this.state.loaded||this.state.loadFailed,currentHistoryNode:this.state.currentHistoryNode,undos:this.state.undos,redos:this.state.redos,goToHistoryNode:this.goToHistoryNode.bind(this),thumbnailsByOperation:this.thumbnailsByOperation})),i)}},{key:"showError",value:function(e){e=Object(d.a)({isError:!0},e),window.console&&e.error&&console.error("(Error details:)",e.error),this.showMessage(e)}},{key:"showMessage",value:function(e){this.showDialog(s.a.createElement(Fe,{message:e.message,error:e.error,isError:e.isError,requestBugReport:e.requestBugReport,extraButtons:e.extraButtons,buttons:e.buttons,close:this.closeDialog.bind(this)}))}},{key:"showDialog",value:function(e){this.setState({dialog:e})}},{key:"closeDialog",value:function(){this.setState({dialog:null})}},{key:"showChooseDocumentDialog",value:function(){var e=this.closeDialog.bind(this);this.showDialog(s.a.createElement(bt,{close:e,currentDocumentID:this.props.documentID}))}},{key:"showSaveDialog",value:function(){var e=this,t=this.props.documentID,n=this.createPNGram.bind(this),a=this.createRawPNG.bind(this),r=this.closeDialog.bind(this),i=this.showError.bind(this),l=this.state,u=document.createElement("a");function d(e){var d=Object(c.useState)("hybrid"),m=Object(h.a)(d,2),f=m[0],p=m[1],v=Object(c.useState)(e.defaultName),g=Object(h.a)(v,2),w=g[0],y=g[1],b=Object(c.useState)(null),E=Object(h.a)(b,2),O=E[0],D=E[1],N=function(e){D((function(t){return URL.revokeObjectURL(t),e}))},k=Object(c.useRef)(null),I={hybrid:"png","raw-image":"png",program:"mop"}[f],S=w.replace(new RegExp("\\."+I+"$","i"),"")+"."+I,j=function(){u.download=S,u.href=O,console.log("Download",O),u.click(),r(),o.a.setItem("document:".concat(t,":name"),w,(function(e){}))};return Object(c.useEffect)((function(){k.current.select()}),[]),Object(c.useEffect)((function(){return function(){N(null),u.remove()}}),[]),Object(c.useEffect)((function(){if(N(null),"hybrid"===f){var e=B(l);n(e,(function(e){var t=URL.createObjectURL(e);N(t)}),(function(){alert("Failed to save hybrid document (probably too large) - try the other save options.")}))}else if("raw-image"===f)a((function(e){var t=URL.createObjectURL(e);N(t)}));else if("program"===f){var t=B(l),o=new Blob([JSON.stringify(t)],{type:"application/x-mopaint+json"}),r=URL.createObjectURL(o);N(r)}else i({message:"This shouldn't happen, saveType=".concat(f),requestBugReport:!0})}),[f]),s.a.createElement(Fe,{message:s.a.createElement("div",{className:"save-dialog-message"},s.a.createElement("form",{className:"save-dialog-form",onSubmit:function(e){e.preventDefault(),j()}},s.a.createElement("label",null,"Name:"," ",s.a.createElement("input",{type:"text",value:w,autoFocus:!0,onChange:function(e){y(e.target.value)},ref:k})),s.a.createElement("div",{style:{marginTop:"1em"}},s.a.createElement("select",{value:f,onChange:function(e){return p(e.target.value)}},s.a.createElement("option",{value:"hybrid"},"Hybrid Mopaint Document and Image (.png)"),s.a.createElement("option",{value:"program"},"Mopaint Document (.mop)"),s.a.createElement("option",{value:"raw-image"},"Raw Image (.png)"))))),close:r,extraButtons:s.a.createElement("button",{onClick:j,disabled:!O},"Save ",O?"":"(please wait...)")})}u.className="for-downloading-files",u.tabIndex=-1,document.body.appendChild(u),o.a.getItem("document:".concat(t,":name")).then((function(t){e.showDialog(s.a.createElement(d,{defaultName:t||"Drawing"}))}),(function(t){e.showDialog(s.a.createElement(d,{defaultName:"Drawing"}))}))}}]),n}(c.Component),kt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function It(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(83);"http:"===window.location.protocol&&window.location.host.match(/editor|app|mopaint/)&&(window.location.protocol="https:");var St=function(e){return"".concat(window.location.origin).concat(window.location.pathname,"?document=").concat(e)},jt=function(e){window.location.search.match(/^\?./)?window.history.pushState({},null,St(e)):window.history.replaceState({},null,St(e)),Pt()},xt=function(){var e=i.a.generate();jt(e)},Lt={serializedDocument:null,documentID:null},Ct=function(e,t){var n=i.a.generate();Lt={serializedDocument:e,documentID:n},console.log("Start new document (".concat(n,") from"),e),o.a.setItem("document:".concat(n,":name"),t.replace(/(\.mop(aint))?(\.png)?$/i,""),(function(e){jt(n)}))},Pt=function(){var e,t=document.getElementById("root"),n=(window.location.search.match(/document=([\w\-./]*)/)||[])[1];n?(n===Lt.documentID&&(e=Lt.serializedDocument,Lt={serializedDocument:null,documentID:null}),u.a.render(s.a.createElement(Nt,{key:n,documentID:n,goToDocument:jt,createNewDocument:xt,loadNewDocument:Ct,serializedDocumentToLoad:e}),t)):xt()};window.addEventListener("popstate",Pt),Pt(),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");kt?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):It(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):It(e)}))}}()}},[[32,1,2]]]);
//# sourceMappingURL=main.72beaf31.chunk.js.map