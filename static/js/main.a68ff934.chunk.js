(this.webpackJsonpmopaint=this.webpackJsonpmopaint||[]).push([[0],{29:function(e,t,n){e.exports=n(71)},42:function(e,t,n){},58:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t){var n,o;window.simulateRandomGesture=function(e){for(var t=document.querySelector("canvas"),o=t.getBoundingClientRect(),a=function(e,n){var a=new MouseEvent(e,{view:window,bubbles:!0,cancelable:!0,clientX:o.left+n.x,clientY:o.top+n.y});t.dispatchEvent(a)},r=0,i=Math.random()*o.width,c=Math.random()*o.height,s=[],l=0;l<5;l+=1)s.push({rx:Math.random()*Math.min(o.width,o.height)/2/5,ry:Math.random()*Math.min(o.width,o.height)/2/5,angularFactor:5*Math.random()-Math.random(),angularOffset:5*Math.random()-Math.random()});var u=function(e){for(var t={x:i,y:c},n=0;n<s.length;n+=1){var o=s[n],a=o.rx,r=o.ry,l=o.angularFactor,u=o.angularOffset;t.x+=Math.sin(2*Math.PI*(e/100*l+u))*a,t.y+=Math.cos(2*Math.PI*(e/100*l+u))*r}return t};a("mousedown",u(r));!function t(){(r+=1)>50?(a("mouseup",u(r)),e&&e()):(a("mousemove",u(r)),n=setTimeout(t,10))}()},window.simulateRandomGesturesPeriodically=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=function t(){o=setTimeout((function(){window.simulateRandomGesture(t)}),e)};window.simulateRandomGesture(t)},window.stopSimulatingGestures=function(){clearTimeout(n),clearTimeout(o)}},71:function(e,t,n){"use strict";n.r(t);var o=n(10),a=n.n(o),r=n(17),i=n.n(r),c=n(0),s=n.n(c),l=n(9),u=n.n(l),d=(n(42),n(28)),h=n(7),m=n(8),f=n(1),p=n(2),v=n(4),g=n(3),w=n(12),y=n(5),b=n(6),E=n(24),O=n(25),D=n.n(O),N=n(18),I=n.n(N),j=n(26),S=n.n(j),k=n(19),x=n.n(k);function M(e,t,n){!function(e,t){var n=new FileReader;n.onload=function(){var e=n.result,o=new Uint8Array(e),a=I()(o);t(a)},n.readAsArrayBuffer(e)}(e,(function(e){for(var o in t)t.hasOwnProperty(o)&&e.splice(-1,0,x.a.encode(o,t[o]));var a=S()(e),r=new Blob([a],{type:"image/png"});n(r)}))}function C(e){for(var t=I()(e).filter((function(e){return"tEXt"===e.name})).map((function(e){return x.a.decode(e.data)})),n={},o=0;o<t.length;o++){var a=t[o];n[a.keyword]=a.text}return n}var L=function(e){return"0".concat(e.toString(16)).slice(-2)},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=new Uint8Array(e/2);return crypto.getRandomValues(t),Array.from(t,L).join("")},P=function e(t){var n=t.parentNode,o=t.timestamp,a=t.operation,r=t.name,i=t.id;Object(f.a)(this,e),this.parentNode=n,this.childNodes=[],this.timestamp=null!==o&&void 0!==o?o:Date.now(),this.operation=a,this.name=r,this.id=null!==i&&void 0!==i?i:R()};function H(e,t){var n=t.currentHistoryNode,o=t.redos,a=t.undos,r=n,i=o.size>0?[o.first()].concat(Object(h.a)(A(o.first()))):[r].concat(Object(h.a)(A(r))),c=A(e);a=new b.List(Object(h.a)(c).reverse()),o=new b.List;for(var s=e;s.childNodes.length>0;){var l=Object(h.a)(s.childNodes);l.sort((function(e,t){return i.indexOf(e)>-1?-1:i.indexOf(t)>-1?1:0})),s=l[0],o=o.unshift(s)}return{currentHistoryNode:e,undos:a,redos:o}}function A(e){var t=[];for(e=e.parentNode;e;e=e.parentNode)t.push(e);return t}function F(e){var t=function(e){for(;e.parentNode;)e=e.parentNode;return e}(e),n=[];return function e(t){var o=!0,a=!1,r=void 0;try{for(var i,c=t.childNodes[Symbol.iterator]();!(o=(i=c.next()).done);o=!0){e(i.value)}}catch(s){a=!0,r=s}finally{try{o||null==c.return||c.return()}finally{if(a)throw r}}n.push(t)}(t),n.sort((function(e,t){return e.timestamp<t.timestamp?-1:t.timestamp<e.timestamp?1:0})),n}function T(e){var t=e.palette,n=e.selectedSwatch,o=e.selectedTool,a=e.undos,r=e.redos,i=e.currentHistoryNode,c=F(i),s=function(e){return e.id},l={};return c.forEach((function(e){var t;l[e.id]={parentHNID:e.parentNode&&e.parentNode.id,childHNIDs:e.childNodes.map(s),timestamp:e.timestamp,operation:e.operation&&(t=e.operation,{id:t.id,toolID:t.tool.name,points:t.points,swatch:t.swatch}),name:e.name,id:e.id}})),{format:"mopaint",formatVersion:.5,palette:t,selectedSwatch:n,selectedToolID:o.name,historyNodesByID:l,undoHNIDs:a.toJS().map(s),redoHNIDs:r.toJS().map(s),currentHNID:s(i)}}var B=function(e,t,n,o,a,r){e.beginPath(),e.moveTo(t,n),e.lineTo(o,a),e.strokeStyle=r,e.lineWidth=5,e.lineCap="round",e.stroke()},z=B,V=function(e,t,n,o,a,r){var i=Math.hypot(o-t,a-n);e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fillStyle=r,e.fill()},U=V,G=function(e,t,n,o,a,r){e.beginPath(),e.rect(t,n,o-t,a-n),e.fillStyle=r,e.fill()};var J=function(e,t,n,o){return[{x:e,y:t},function(e,t){return{x:2*n-e,y:t}}(e,t)]},W=function(e,t,n,o){for(var a=e-n,r=o-t,i=Math.hypot(a,r),c=Math.atan2(a,r)+0,s=[],l=0;l<6;l++){var u=c+2*Math.PI/6*l;e=n+Math.sin(u)*i,t=o-Math.cos(u)*i,s.push({x:e,y:t})}return s};function q(){return(q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Y(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Q=s.a.createElement("g",null),_=s.a.createElement("g",null),K=s.a.createElement("g",null),X=s.a.createElement("g",null),Z=s.a.createElement("g",null),$=s.a.createElement("g",null),ee=s.a.createElement("g",null),te=s.a.createElement("g",null),ne=s.a.createElement("g",null),oe=s.a.createElement("g",null),ae=s.a.createElement("g",null),re=s.a.createElement("g",null),ie=s.a.createElement("g",null),ce=s.a.createElement("g",null),se=s.a.createElement("g",null),le=function(e){var t=e.svgRef,n=e.title,o=Y(e,["svgRef","title"]);return s.a.createElement("svg",q({id:"Capa_1",x:"0px",y:"0px",viewBox:"0 0 18.713 18.713",style:{enableBackground:"new 0 0 18.713 18.713"},xmlSpace:"preserve",ref:t},o),n?s.a.createElement("title",null,n):null,s.a.createElement("g",{transform:"scale(-1,1) translate(-18.713,0)"},s.a.createElement("path",{style:{fill:"#030104"},d:"M13.367,6.434L8.872,1.895l-0.65-0.672L6.687,2.731c-2.624-0.375-4.51,0.59-5.178,1.777 C0.698,5.949,1.527,7.522,1.553,7.57c0.693,1.385,1.689,2.216,2.961,2.473c0.279,0.055,0.56,0.08,0.84,0.08 c1.322,0,2.644-0.561,3.649-1.135c0.271,0.188,0.601,0.299,0.954,0.299c0.93,0,1.686-0.759,1.686-1.691s-0.756-1.69-1.686-1.69 s-1.686,0.758-1.686,1.69c0,0.093,0.013,0.184,0.027,0.274C7.286,8.445,5.951,8.986,4.77,8.748C3.905,8.573,3.237,7.995,2.719,6.96 C2.714,6.95,2.203,5.957,2.654,5.157c0.38-0.676,1.371-1.111,2.883-1.275L5.302,4.119L3.13,6.299 c0.023,0.053,0.04,0.085,0.041,0.087c0.209,0.418,0.444,0.758,0.706,1.03l3.932-3.943c0.187-0.187,0.435-0.29,0.698-0.29 s0.513,0.103,0.698,0.29l4.771,4.787c0.385,0.385,0.385,1.014,0,1.399L7.774,15.88c-0.372,0.373-1.023,0.373-1.396,0l-4.772-4.787 c-0.187-0.186-0.289-0.434-0.289-0.699c0-0.264,0.102-0.514,0.289-0.7l0.515-0.518C1.828,8.874,1.568,8.512,1.335,8.098 l-0.66,0.663C0.24,9.197,0,9.777,0,10.394c0,0.617,0.24,1.197,0.675,1.633l4.772,4.787c0.435,0.436,1.012,0.676,1.628,0.676 c0.614,0,1.193-0.24,1.628-0.676l6.201-6.221L16.205,9.3l-0.361-0.365c0.683-0.373,0.987,2.744,0.987,2.744s0.954,7.439,1.802,0 C19.443,4.56,13.854,6.272,13.367,6.434z"})),Q,_,K,X,Z,$,ee,te,ne,oe,ae,re,ie,ce,se)},ue=s.a.forwardRef((function(e,t){return s.a.createElement(le,q({svgRef:t},e))})),de=(n.p,{"Freeform Line":{drawSegmentOfPath:z},Line:{drawShape:z},"Freeform Circles":{drawSegmentOfPath:U},Circle:{drawShape:U},Rectangle:{drawShape:G},Fill:{Icon:ue,drawFromPoint:function(e,t,n,o,a){e.drawImage(a.canvas,0,0),function(e,t,n,o){var a=e.canvas;if(t=Math.floor(t),n=Math.floor(n),!(t<0||n<0||t>a.width||n>a.height)){var r=[[t,n]],i=e.getImageData(0,0,a.width,a.height),c=4*(n*a.width+t),s=i.data[c+0],l=i.data[c+1],u=i.data[c+2],d=i.data[c+3],h=document.createElement("canvas").getContext("2d");h.fillStyle=o,h.fillRect(0,0,1,1);var f=h.getImageData(0,0,1,1),p=Object(m.a)(f.data,4),v=p[0],g=p[1],w=p[2],y=p[3];if(v!==s||g!==l||w!==u||y!==d){for(;r.length;){var b,E,O=void 0,D=void 0,N=void 0,I=void 0;for(E=(b=r.pop())[0],D=4*((O=b[1])*a.width+E);j(D);)D=4*(--O*a.width+E);for(N=!1,I=!1;D=4*(++O*a.width+E),O<a.height&&j(D);)S(D),E>0&&(j(D-4)?N||(r.push([E-1,O]),N=!0):N&&(N=!1)),E<a.width-1&&(j(D+4)?I||(r.push([E+1,O]),I=!0):I&&(I=!1)),D+=4*a.width}e.putImageData(i,0,0)}}function j(e){return i.data[e+0]===s&&i.data[e+1]===l&&i.data[e+2]===u&&i.data[e+3]===d}function S(e){i.data[e+0]=v,i.data[e+1]=g,i.data[e+2]=w,i.data[e+3]=y}}(e,t,n,o)}}});Object.keys(de).forEach((function(e){var t=de[e];t.drawSegmentOfPath&&(t.drawFromGesturePoints=function(e,n,o){for(var a=0,r=1;r<n.length;a+=1,r+=1)t.drawSegmentOfPath(e,n[a].x,n[a].y,n[r].x,n[r].y,o)},t.getPreviewGesturePoints=function(e,t){for(var n=[],o=0;o<20;o+=2)n.push({x:e/2+48*Math.sin(Math.sin(o*o/302)),y:t/2+48*Math.cos(Math.sin(o/5))});return n}),t.drawShape&&(t.drawFromGesturePoints=function(e,n,o){var a=n[0],r=n[n.length-1];t.drawShape(e,a.x,a.y,r.x,r.y,o)},t.getPreviewGesturePoints=function(e,t){return[{x:.5*e,y:.5*t},{x:.8*e,y:.8*t}]}),t.drawFromPoint&&(t.drawFromGesturePoints=function(e,n,o,a){var r=n[n.length-1];t.drawFromPoint(e,r.x,r.y,o,a)},t.getPreviewGesturePoints=function(e,t){return{x:e/2,y:t/2}})})),[{prefix:"Mirror Symmetric ",pointToPoints:J},{prefix:"Rotationally Symmetric ",pointToPoints:W}].forEach((function(e){Object.keys(de).forEach((function(t){var n=de[t],o=e.prefix+t;if(!n.drawFromPoint&&n.drawFromGesturePoints){var a=de[o]={};a.drawFromGesturePoints=function(t,o,a,r){var i=[],c=t.canvas.width/2,s=t.canvas.height/2,l=!0,u=!1,d=void 0;try{for(var h,m=o[Symbol.iterator]();!(l=(h=m.next()).done);l=!0)for(var f=h.value,p=e.pointToPoints(f.x,f.y,c,s),v=0;v<p.length;v++)i[v]=i[v]||[],i[v].push(p[v])}catch(b){u=!0,d=b}finally{try{l||null==m.return||m.return()}finally{if(u)throw d}}for(var g=0,w=i;g<w.length;g++){var y=w[g];n.drawFromGesturePoints(t,y,a,r)}},a.getPreviewGesturePoints=function(e,t){return n.getPreviewGesturePoints(e/2,t/2)}}}))}));var he=Object.keys(de).map((function(e){var t=de[e];return t.name=e,t})),me=de,fe=(n(58),n(27)),pe=n.n(fe),ve=document.createElement("canvas"),ge=ve.getContext("2d"),we=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).operation=null,n.canvasRef=s.a.createRef(),n.cache={},n.hashInDocumentByOperation=new Map,n}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;this.animationFrameID&&cancelAnimationFrame(this.animationFrameID),this.animationFrameID=requestAnimationFrame((function(){!function(e){var t=e.documentCanvas,n=e.operations,o=e.thumbnailsByOperation,a=e.cache,r=e.hashInDocumentByOperation,i=t.getContext("2d");i.clearRect(0,0,ve.width,ve.height),ve.width=t.width,ve.height=t.height;var c=pe()();n.forEach((function(e,t){c.update(JSON.stringify(e));var n=c.digest("hex");if(ge.clearRect(0,0,ve.width,ve.height),a[n])i.drawImage(a[n],0,0);else{var s=e.points,l=e.tool,u=e.swatch;l.drawFromGesturePoints(ge,s,u,i),i.drawImage(ve,0,0),r.set(e,n),e.updatingContinously||(a[n]=document.createElement("canvas"),a[n].width=ve.width,a[n].height=ve.height,a[n].getContext("2d").drawImage(ve,0,0));var d=document.createElement("canvas");d.width=64,d.height=64,d.getContext("2d").drawImage(ve,0,0,64,64),o.set(e,d)}}))}({documentCanvas:e.canvasRef.current,operations:e.props.operations,thumbnailsByOperation:e.props.thumbnailsByOperation,cache:e.cache,hashInDocumentByOperation:e.hashInDocumentByOperation})}));return s.a.createElement("div",{className:"DrawingCanvas",style:{width:640,height:480}},s.a.createElement("canvas",{width:640,height:480,ref:this.canvasRef}))}},{key:"toCanvasCoords",value:function(e){var t=this.canvasRef.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}},{key:"onMouseMoveWhileDown",value:function(e){e.preventDefault();var t=this.toCanvasCoords(e);this.operation&&(this.operation.points.push(t),(0,this.props.updateOperation)(this.operation))}},{key:"onMouseDown",value:function(e){if(1===e.which){e.preventDefault();var t=this.props,n=t.selectedSwatch,o=t.selectedTool;if(o){var a=this.toCanvasCoords(e);this.operation={id:R(10),points:[a],tool:o,swatch:n,updatingContinously:!0},(0,this.props.addOperation)(this.operation),e.target.setCapture?e.target.setCapture():document.body.classList.add("cursor-override-DrawingCanvas")}else console.warn("no tool selected")}}},{key:"onMouseUp",value:function(e){var t=this.props.updateOperation;this.operation&&(delete this.operation.updatingContinously,t(this.operation),document.body.classList.remove("cursor-override-DrawingCanvas"))}},{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current,n=!1;t.addEventListener("mousedown",this.mouseDownListener=function(t){n||0===t.button&&(n=!0,e.onMouseDown(t),window.addEventListener("mousemove",e.mouseMoveListener=function(t){e.onMouseMoveWhileDown(t)}),window.addEventListener("mouseup",e.mouseUpListener=function(t){window.removeEventListener("mousemove",e.mouseMoveListener),window.removeEventListener("mouseup",e.mouseUpListener),n=!1,e.onMouseUp(t)}))})}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("mousedown",this.mouseDownListener),window.removeEventListener("mousemove",this.mouseMoveListener),window.removeEventListener("mouseup",this.mouseUpListener),cancelAnimationFrame(this.animationFrameID)}}]),t}(c.Component),ye=function(){function e(e,t,n){for(var o=0;o<t;++o)if(0!==e.data[n*t*4+4*o+3])return!1;return!0}function t(e,t,n,o,a){for(var r=o;r<a;++r)if(0!==e.data[r*t*4+4*n+3])return!1;return!0}return function(n){for(var o=n.getContext("2d"),a=n.width,r=o.getImageData(0,0,n.width,n.height),i=0,c=r.height,s=0,l=r.width;i<c&&e(r,a,i);)++i;for(;c-1>i&&e(r,a,c-1);)--c;for(;s<l&&t(r,a,s,i,c);)++s;for(;l-1>s&&t(r,a,l-1,i,c);)--l;var u=o.getImageData(s,i,l-s||1,c-i||1),d=n.ownerDocument.createElement("canvas"),h=d.getContext("2d");return d.width=u.width,d.height=u.height,h.putImageData(u,0,0),d}}(),be=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,o=e.tool;return o.Icon?s.a.createElement(o.Icon,{className:"ToolPreview",width:t,height:n}):s.a.createElement("canvas",{className:"ToolPreview",width:t,height:n,ref:"canvas"})}},{key:"componentDidMount",value:function(){var e=u.a.findDOMNode(this.refs.canvas);if(e){var t=e.getContext("2d"),n=document.createElement("canvas");n.width=128,n.height=128;var o=n.getContext("2d"),a=this.props.tool,r=a.getPreviewGesturePoints(n.width,n.height);a.drawFromGesturePoints(o,r,"black");var i,c,s=ye(n);s.width>s.height?(i=e.width,c=s.height/s.width*e.width):(i=s.width/s.height*e.width,c=e.width),t.drawImage(s,(e.width-i)/2,(e.height-c)/2,i,c)}}}]),t}(c.Component),Ee=(n(62),function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tools,n=e.selectedTool,o=e.selectTool;return t=t||[],s.a.createElement("div",{className:"Toolbox",role:"radiogroup"},t.map((function(e){var t=n===e;return s.a.createElement("button",{key:e.name,className:"Toolbox-tool",role:"radio","aria-checked":t?"aria-checked":null,onClick:function(){o(e)},title:e.name},s.a.createElement(be,{tool:e,width:48,height:48}))})))}}]),t}(c.Component)),Oe=(n(63),function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.palette,n=e.selectedSwatch,o=e.selectSwatch;return s.a.createElement("div",{className:"Palette",role:"radiogroup"},t.map((function(e){var t=n===e;return s.a.createElement("button",{key:e,className:"Palette-swatch swatch",style:{backgroundColor:e},role:"radio","aria-checked":t?"aria-checked":null,onClick:function(){o(e)}})})))}}]),t}(c.Component)),De=(n(64),function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.palette,n=e.selectedSwatch,o=e.selectSwatch;return s.a.createElement("div",{className:"Colorbox"},s.a.createElement("div",{className:"Colorbox-selected-swatches"},s.a.createElement("div",{className:"Colorbox-selected-swatch swatch",key:n,style:{backgroundColor:n}})),s.a.createElement("div",{className:"Colorbox-divider"}),s.a.createElement(Oe,{palette:t,selectedSwatch:n,selectSwatch:o}))}}]),t}(c.Component));n(65);var Ne=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.width,o=t.height;return this.props.drawFunctionsArrayToAddTo.push((function(){return e.draw()})),this.maybeLoadingTime=0,s.a.createElement("canvas",{width:n,height:o})}},{key:"draw",value:function(){var e=this.props,t=e.indexInListForAnimationOffset,n=e.getImageMaybe,o=u.a.findDOMNode(this);if(function(e){var t=e.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>=0}(o)){var a=o.getContext("2d");a.clearRect(0,0,o.width,o.height);var r=n();if(r)a.drawImage(r,0,0,o.width,o.height);else{for(var i=0;i<4;i+=1){var c=Math.min(o.width,o.height)/2*(2+Math.sin(i*Math.PI/2+performance.now()/1e3-.03*t))/3;a.fillStyle="rgba(128, 128, 128, ".concat(.8*Math.max(0,Math.sin(Math.PI/2+i*Math.PI/2+performance.now()/1e3-.03*t)),")"),a.beginPath(),a.arc(o.width/2,o.height/2,c,0,2*Math.PI,!1),a.fill()}a.fillStyle="white",a.textBaseline="middle",a.textAlign="center",a.font="".concat(Math.min(o.width,o.height)/2*.9,"px sans-serif"),a.fillText("?",o.width/2,o.height/2)}}}},{key:"componentDidMount",value:function(){this.draw()}},{key:"componentDidUpdate",value:function(){this.draw()}}]),t}(c.Component),Ie=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.current,o=t.ancestorOfCurrent,a=t.onClick,r=t.historyNode,i=t.indexInListForAnimationOffset,c=t.drawFunctionsArrayToAddTo,l=t.getThumbnailImageMaybe,u=t.getIconReactElementMaybe,d=r.operation;return s.a.createElement("button",{className:"HistoryEntry"+(n?" current":"")+(o?" ancestor-of-current":""),role:"radio","aria-checked":n?"aria-checked":null,onClick:a,onMouseDown:a},s.a.createElement(Ne,{width:24,height:24,indexInListForAnimationOffset:i,drawFunctionsArrayToAddTo:c,getImageMaybe:l}),null!==(e=null===u||void 0===u?void 0:u())&&void 0!==e?e:d&&s.a.createElement(be,{tool:d.tool,width:16,height:16}),r.name)}}]),t}(c.Component);n(66);function je(){return(je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Se(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var ke=s.a.createElement("path",{fill:"#95a5a6",d:"M5 0c-.982 0-3 2.018-3 3v10c0 1 1 2 2 2h8c.982 0 .762-1.048 1-2V5L9 0z"}),xe=s.a.createElement("path",{fill:"#bdc3c7",d:"M4 0c-.982 0-2 1.018-2 2v10c0 .982 1.018 2 2 2h8c.982 0 1.73-1.056 2-2V5L9 0z"}),Me=s.a.createElement("path",{fill:"#95a5a6",d:"M14 5L9 0v3c0 .982 1.018 2 2 2z"}),Ce=s.a.createElement("g",{transform:"matrix(.5 0 0 .5 9.225 -504.681)"},s.a.createElement("circle",{cx:6.55,cy:1034.362,r:7,fill:"#27ae60"}),s.a.createElement("circle",{cx:6.55,cy:1032.362,r:7,fill:"#2ecc71"}),s.a.createElement("path",{fill:"#27ae60",d:"M1.55 1035.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z"}),s.a.createElement("path",{fill:"#ecf0f1",d:"M1.55 1033.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z"})),Le=function(e){var t=e.svgRef,n=e.title,o=Se(e,["svgRef","title"]);return s.a.createElement("svg",je({width:16,height:16,viewBox:"0 0 16 16",ref:t},o),n?s.a.createElement("title",null,n):null,ke,xe,Me,Ce)},Re=s.a.forwardRef((function(e,t){return s.a.createElement(Le,je({svgRef:t},e))})),Pe=(n.p,new Image);Pe.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var He=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).currentEntryRef=s.a.createRef(),n.drawFunctions=[],n}return Object(y.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function t(){e.animationFrameID=requestAnimationFrame(t),e.drawFunctions.forEach((function(e){return e()}))}(),this.scrollSelectedEntryIntoView()}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.animationFrameID)}},{key:"componentDidUpdate",value:function(e){this.props.undos.size!==e.undos.size&&this.scrollSelectedEntryIntoView()}},{key:"scrollSelectedEntryIntoView",value:function(){var e=this.currentEntryRef.current&&u.a.findDOMNode(this.currentEntryRef.current);e&&e.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}},{key:"render",value:function(){var e=this;this.drawFunctions=[];var t=this.props,n=t.currentHistoryNode,o=t.goToHistoryNode,a=t.thumbnailsByOperation,r=A(n),i=F(n);return s.a.createElement("div",{className:"HistoryView",role:"radiogroup"},i.map((function(t){var i=r.indexOf(t)>-1,c=t===n;return s.a.createElement(Ie,{key:t.id,historyNode:t,current:c,ref:c&&e.currentEntryRef,ancestorOfCurrent:i,onClick:function(){return o(t)},indexInListForAnimationOffset:0,drawFunctionsArrayToAddTo:e.drawFunctions,getThumbnailImageMaybe:function(){return t.operation?a.get(t.operation):Pe},getIconReactElementMaybe:function(){return"New Document"===t.name?s.a.createElement(Re,{width:16,height:16}):null}})})))}}]),t}(c.Component),Ae=(n(67),function(e){return s.a.createElement("a",{href:"https://github.com/1j01/mopaint/issues/",target:"_blank",rel:"noopener noreferrer"},e.children)});function Fe(e){var t=e.message,n=e.error,o=(e.isError,e.requestBugReport),a=e.close,r=e.extraButtons,i=e.buttons,c=n&&n.stack&&(0===n.stack.indexOf(n.toString())?n.stack.slice(n.toString().length).trimEnd():"\n".concat(n.stack.trim()).replace(/\n/g,"\n    ")),l=n&&(c?"".concat(n.toString(),"\n\nStack trace:").concat(c):n.toString());return s.a.createElement("div",{className:"Dialog"},s.a.createElement("div",{className:"Dialog-box"},t||n.message,n&&s.a.createElement("details",null,s.a.createElement("summary",null,"Details"),s.a.createElement("div",{className:"actual-details"},s.a.createElement("pre",null,l))),o&&s.a.createElement("div",null,"You should ",s.a.createElement(Ae,null,"report this bug"),"."),s.a.createElement("div",{className:"Dialog-buttons"},i||s.a.createElement("button",{onClick:a},"Close"),r)))}n(68);var Te=function(e){return s.a.createElement("div",{className:"Warning"},e.children)},Be=["rgb(0,0,0)","rgb(34,32,52)","rgb(69,40,60)","rgb(102,57,49)","rgb(143,86,59)","rgb(223,113,38)","rgb(217,160,102)","rgb(238,195,154)","rgb(251,242,54)","rgb(153,229,80)","rgb(106,190,48)","rgb(55,148,110)","rgb(75,105,47)","rgb(82,75,36)","rgb(50,60,57)","rgb(63,63,116)","rgb(48,96,130)","rgb(91,110,225)","rgb(99,155,255)","rgb(95,205,228)","rgb(203,219,252)","rgb(255,255,255)","rgb(155,173,183)","rgb(132,126,135)","rgb(105,106,106)","rgb(89,86,82)","rgb(118,66,138)","rgb(172,50,50)","rgb(217,87,99)","rgb(215,123,186)","rgb(143,151,74)","rgb(138,111,48)"];n(69);function ze(){return(ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Ve(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ue=s.a.createElement("path",{d:"M7 0c-.982 0-3 2.018-3 3v16c0 1 1 2 2 2h12c.982 0 1-1.018 1-2V5l-4-5z",fill:"#95a5a6"}),Ge=s.a.createElement("path",{d:"M6 0c-.982 0-2 1.018-2 2v16c0 .982 1.018 2 2 2h12c.982 0 2-1.018 2-2V5l-5-5z",fill:"#bdc3c7"}),Je=s.a.createElement("path",{d:"M20 5l-5-5v3c0 .982 1.03 1.845 2 2z",fill:"#95a5a6"}),We=s.a.createElement("g",{transform:"matrix(.5 0 0 .5 16.225 -497.681)"},s.a.createElement("circle",{cx:6.55,cy:1034.362,r:9,fill:"#27ae60"}),s.a.createElement("circle",{cx:6.55,cy:1032.362,r:9,fill:"#2ecc71"}),s.a.createElement("path",{d:"M1.55 1035.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z",fill:"#27ae60"}),s.a.createElement("path",{d:"M1.55 1033.362h4v4h2v-4h4v-2h-4v-4h-2v4h-4z",fill:"#ecf0f1"})),qe=function(e){var t=e.svgRef,n=e.title,o=Ve(e,["svgRef","title"]);return s.a.createElement("svg",ze({width:24,height:24,viewBox:"0 0 24 24",ref:t},o),n?s.a.createElement("title",null,n):null,Ue,Ge,Je,We)},Ye=s.a.forwardRef((function(e,t){return s.a.createElement(qe,ze({svgRef:t},e))}));n.p;function Qe(){return(Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ke=s.a.createElement("path",{d:"M1.632 6.314C.73 6.314 0 7.044 0 7.946v11.422C0 20.27.78 21 1.682 21H17.75c1.401 0 2.281-2.21 2.253-2.42l-.422-.549V7.946c0-.902-.73-1.632-1.631-1.632z",fill:"#2980b9"}),Xe=s.a.createElement("path",{d:"M3 3c-.901 0-2 1.099-2 2v10.928c0 1 .546 1.808 1.448 1.808H17.134c.901 0 1.632-.73 1.632-1.631V6.532C18.766 5.633 17.9 5 17 5H10.473L8 3z",fill:"#2980b9"}),Ze=s.a.createElement("path",{d:"M18.52 19.368L20 8c.118-.909-.203-2-1.203-2H4c-.901 0-1.42.229-1.557 1.13L1 19z",fill:"#bdc3c7"}),$e=s.a.createElement("path",{d:"M6 7c-.901 0-1.362.044-1.68.946L2.591 12.84l-.288.816L1 18c-.318.901 0 2 2 2h15.14c.902 0 1.34-.156 1.799-1.12l1.946-5.223.288-.816 1.463-4.32c.428-1.1.172-1.521-.972-1.521z",fill:"#3498db"}),et=function(e){var t=e.svgRef,n=e.title,o=_e(e,["svgRef","title"]);return s.a.createElement("svg",Qe({width:24,height:24,viewBox:"0 0 24 24",ref:t},o),n?s.a.createElement("title",null,n):null,Ke,Xe,Ze,$e)},tt=s.a.forwardRef((function(e,t){return s.a.createElement(et,Qe({svgRef:t},e))}));n.p;function nt(){return(nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function ot(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var at=s.a.createElement("path",{d:"M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-3H5z",fill:"#3498db"}),rt=s.a.createElement("path",{d:"M7 3v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3H7z",fill:"#2980b9"}),it=s.a.createElement("path",{d:"M7 3v5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3H7zM6 12a1 1 0 0 0-1 1v8h14v-8a1 1 0 0 0-1-1H6z",fill:"#ecf0f1"}),ct=s.a.createElement("path",{fill:"#bdc3c7",d:"M5 20h14v1H5zM7 14h10v1H7zM7 16h10v1H7z"}),st=s.a.createElement("path",{fill:"#3498db",d:"M13 4h3v4h-3z"}),lt=s.a.createElement("path",{fill:"#2980b9",d:"M13 4h3v1h-3z"}),ut=function(e){var t=e.svgRef,n=e.title,o=ot(e,["svgRef","title"]);return s.a.createElement("svg",nt({width:24,height:24,viewBox:"0 0 24 24",ref:t},o),n?s.a.createElement("title",null,n):null,at,rt,it,ct,st,lt)},dt=s.a.forwardRef((function(e,t){return s.a.createElement(ut,nt({svgRef:t},e))})),ht=(n.p,function(e){var t=me[e];if(!t)throw new Error("Tool not found with name '".concat(e,"'"));return t}),mt=function(e){function t(e){var n;Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).state={palette:Be,selectedSwatch:Be[0],selectedTool:ht("Freeform Line"),undos:new b.List,redos:new b.List,currentHistoryNode:new P({name:"New Document"}),loaded:!1,loadFailed:!1},n.thumbnailsByOperation=new Map,n.timeoutIDs=new Set;return n.saveDebounced=function(e,t){var o;return function(){clearTimeout(o),n.timeoutIDs.delete(o),o=setTimeout(e,t),n.timeoutIDs.add(o)}}(n.save.bind(Object(w.a)(n)),500),n}return Object(y.a)(t,e),Object(p.a)(t,[{key:"loadSerializedDocument",value:function(e,t){var n,o,a=this;try{var r=function(e,t,n){var o=t?"document":"document state";if("mopaint"!==e.format)return[{message:"Can't load ".concat(o," - it does not appear to be a Mopaint document")}];if("number"!==typeof e.formatVersion||e.formatVersion>.5)return[{message:"Can't load ".concat(o," created by later version of the app")}];if(.1===e.formatVersion&&(e.formatVersion=.3),.3===e.formatVersion){e.formatVersion=.4;var a=+new Date("January 1, 2020 00:00:00"),r={name:"New Document",id:R(),childHNIDs:[],timestamp:a},i={};i[r.id]=r;var c,l=new Map,u=function(e){var t=R();i[t]={id:t,operation:e,name:e.toolID,parentHNID:void 0,childHNIDs:[],timestamp:a},l.set(e,i[t])};e.undos.forEach(u),e.redos.forEach(u);var d=[],f=[],p=[].concat(Object(h.a)(e.undos),Object(h.a)(Object(h.a)(e.redos).reverse()));[r].concat(Object(h.a)(p.map((function(e){return l.get(e)})))).forEach((function(e,t,n){var o,a,r=n[t-1];r&&(a=e,(o=r)&&(o.childHNIDs.push(a.id),a.parentHNID=o.id)),e.timestamp+=t})),d.push(r.id),p.forEach((function(t){var n=l.get(t);t===e.undos[e.undos.length-1]?c=n.id:e.redos.indexOf(t)>-1?f.push(n.id):d.push(n.id)})),e.historyNodesByID=i,e.currentHNID=c,e.undoHNIDs=d,e.redoHNIDs=f,delete e.undos,delete e.redos}if(.4===e.formatVersion){e.formatVersion=.5;for(var v=0,g=Object.values(e.historyNodesByID);v<g.length;v++){var w,y=g[v];if("Fill"===(null===(w=y.operation)||void 0===w?void 0:w.name))y.operation.points.length=1}}if(e.formatVersion<.5){var E="format-version-".concat(e.formatVersion);return[{message:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Can't load ",o," created by old version of the app; there's no upgrade path from format version ",e.formatVersion," to ",.5," (minimum loadable: ".concat(.1,")")),s.a.createElement("p",null,"To load this ",o,", use the version of Mopaint at the Git branch\xa0",s.a.createElement("a",{href:"https://github.com/1j01/mopaint/tree/".concat(E),style:{fontFamily:"monospace"}},E)))}]}var O=function(e,t,n){e.forEach((function(e){if(!t[e])throw new TypeError("expected property '".concat(e,"' ").concat(n))}))},D=function(e){O(["id","toolID","points","swatch"],e,"on operation with ID ".concat(e.id));var t=n(e.toolID);return{id:e.id,tool:t,points:e.points,swatch:e.swatch}};O(["palette","selectedSwatch","selectedToolID","undoHNIDs","redoHNIDs","currentHNID","historyNodesByID"],e,"on the root document object");for(var N={},I=0,j=Object.entries(e.historyNodesByID);I<j.length;I++){var S=j[I],k=Object(m.a)(S,2),x=k[0],M=k[1];N[x]=new P(M),M.operation&&(N[x].operation=D(M.operation))}for(var C=function(e){return N[e]},L=0,H=Object.entries(e.historyNodesByID);L<H.length;L++){var A=H[L],F=Object(m.a)(A,2),T=F[0],B=F[1];N[T].parentNode=N[B.parentHNID],N[T].childNodes=B.childHNIDs.map(C)}return[null,{palette:e.palette,selectedSwatch:e.selectedSwatch,selectedTool:n(e.selectedToolID),undos:new b.List(e.undoHNIDs.map(C)),redos:new b.List(e.redoHNIDs.map(C)),currentHistoryNode:C(e.currentHNID)}]}(e,t,ht),i=Object(m.a)(r,2);n=i[0],o=i[1]}catch(c){n={message:"Failed to load document!",error:c}}n?(this.showError(n),this.setState({loadFailed:!0})):(o.loaded=!0,this.setState(o,(function(){console.log("Loaded ".concat(a.props.documentID))})))}},{key:"load",value:function(){var e=this;if(this.props.documentID){console.log("Load ".concat(this.props.documentID));var t=this.props.serializedDocumentToLoad;a.a.getItem("document:".concat(this.props.documentID,":state"),(function(n,o){if(n)return e.showError({message:"Failed to load document state from storage!",error:n}),void e.setState({loadFailed:!0});if(t)o?e.showError({message:"Almost loaded a document over an existing document. This shouldn't happen!",requestBugReport:!0}):e.loadSerializedDocument(t);else{if(!o)return e.setState({loaded:!0}),void console.log("State loaded as empty for document:".concat(e.props.documentID,":state"));console.log("Loaded data for ".concat(e.props.documentID)),e.loadSerializedDocument(o)}}))}else console.log("No document ID to load")}},{key:"save",value:function(e){var t=this;if(this.state.loaded){var n=T(this.state);a.a.setItem("document:".concat(this.props.documentID,":state"),n,(function(n){var o=e?"the previous document":"document";n?"QuotaExceededError"!==n.name||n.message?"QuotaExceededError"===n.name?t.showError({message:s.a.createElement("div",null,"Failed to save ",o," into storage!",s.a.createElement("br",null),s.a.createElement("br",null),"Ran out of space allowed by the browser. You could free up quota by clearing the storage for this site in your browser's settings, however, this will delete all documents."),error:n}):t.showError({message:"Failed to save ".concat(o," into storage!"),error:n}):t.showError({message:s.a.createElement("div",null,"Failed to save ",o," into storage!",s.a.createElement("br",null),s.a.createElement("br",null),"Check that your computer has enough disk space.",s.a.createElement("br",null),s.a.createElement("br",null),"If you have enough free space, we've run out of space as allowed by the browser per site. You could free up quota by clearing the storage for this site in your browser's settings, however, this will delete all documents."),error:n}):console.log("Saved ".concat(t.props.documentID).concat(e?" (leaving it)":""))}))}else e||(this.setState({undos:new b.List,redos:new b.List,loaded:!1}),this.showError({message:"The document ".concat(this.state.loadFailed?"failed to load":"hasn't loaded yet",". Start a new document?"),extraButtons:s.a.createElement("button",{onClick:this.props.createNewDocument},"New Document")}))}},{key:"createPNGram",value:function(e,t,n){var o=JSON.stringify(e),a={Software:"Mopaint","Mopaint Format Version":e.formatVersion,"Creation Time":(new Date).toUTCString(),"Program Source":o};console.log("Save PNG with metadata",a);this.createRawPNG((function(e){M(e,a,(function(e){!function(e,t,n){var a=new FileReader;a.onload=function(){var e=a.result;C(new Uint8Array(e))["Program Source"]===o?t():n()},a.readAsArrayBuffer(e)}(e,(function(){t(e)}),(function(){n()}))}))}))}},{key:"createRawPNG",value:function(e){document.querySelector(".DrawingCanvas canvas").toBlob(e,"image/png")}},{key:"loadDocumentFromJSON",value:function(e){var t;try{t=JSON.parse(e)}catch(n){return void this.showError({message:s.a.createElement("div",null,"Failed to load as Mopaint document, invalid JSON",s.a.createElement("details",null,s.a.createElement("summary",null,"JSON"),s.a.createElement("div",{className:"actual-details"},s.a.createElement("pre",null,e)))),error:n})}this.props.loadNewDocument(t)}},{key:"handleDroppedOrOpenedFiles",value:function(e){var t=this,n=e[0];if(n){var o=new FileReader;o.onload=function(){var e=o.result,a=new Uint8Array(e);if(D()(a)){var r=C(a);if(r["Mopaint Format Version"]){var i=r["Program Source"];t.loadDocumentFromJSON(i)}else t.showError({message:"Loading images is not supported yet (other than Mopaint PNG programs)"})}else if(a[0]==="{".charCodeAt(0)){var c=new FileReader;c.onload=function(){t.loadDocumentFromJSON(c.result)},c.readAsText(n)}else Object(E.load)(n,(function(e,n){e?t.showError({message:"Failed to load file as a color palette.",error:e}):t.setState({palette:n.map((function(e){return e.toString()}))},t.saveDebounced.bind(t))}))},o.readAsArrayBuffer(n)}}},{key:"openDocument",value:function(){var e=this,t=document.createElement("input");t.type="file",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",(function(){e.handleDroppedOrOpenedFiles(t.files),t.remove()})),t.click()}},{key:"componentDidMount",value:function(){var e=this;this.load(),window.addEventListener("beforeunload",this.beforeUnloadListener=function(t){e.save(!0)}),window.addEventListener("keydown",this.keyDownListener=function(t){if("Escape"!==t.key){if((!document.activeElement||!document.activeElement.matches("input, textarea"))&&t.ctrlKey){if("z"===t.key)e.undo();else if("Z"===t.key||"y"===t.key)e.redo();else if("s"===t.key||"S"===t.key)e.showSaveDialog();else{if("o"!==t.key)return;e.openDocument()}t.preventDefault()}}else e.closeDialog()}),window.addEventListener("dragover",this.dragOverListener=function(e){e.preventDefault()}),window.addEventListener("drop",this.dropListener=function(t){t.preventDefault(),e.handleDroppedOrOpenedFiles(t.dataTransfer.files)})}},{key:"componentWillUnmount",value:function(){this.save(!0),this.timeoutIDs.forEach((function(e){clearTimeout(e)})),window.removeEventListener("beforeunload",this.beforeUnloadListener),window.removeEventListener("keydown",this.keyDownListener),window.removeEventListener("dragover",this.dragOverListener),window.removeEventListener("drop",this.dropListener)}},{key:"componentWillReceiveProps",value:function(e){console.assert(e.documentID===this.props.documentID,"App component is not designed to handle switching documents without reconstruction")}},{key:"addOperation",value:function(e){var t=this.state,n=t.currentHistoryNode,o=t.undos,a=t.redos;a=new b.List,o=o.push(n);var r=new P({parentNode:n,name:e.tool.name,operation:e});n.childNodes.push(r),n=r,this.setState({currentHistoryNode:n,undos:o,redos:a},this.save.bind(this))}},{key:"updateOperation",value:function(e){this.setState({currentHistoryNode:this.state.currentHistoryNode},this.saveDebounced.bind(this))}},{key:"undo",value:function(){var e=this.state,t=function(e){var t=e.currentHistoryNode,n=e.undos,o=e.redos;return n.size<1?{currentHistoryNode:t,undos:n,redos:o}:(o=o.push(t),H(n.last(),{currentHistoryNode:t,undos:n=n.pop(),redos:o}))}({currentHistoryNode:e.currentHistoryNode,undos:e.undos,redos:e.redos});this.setState({currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos},this.saveDebounced.bind(this))}},{key:"redo",value:function(){var e=this.state,t=function(e){var t=e.currentHistoryNode,n=e.undos,o=e.redos;return o.size<1?{currentHistoryNode:t,undos:n,redos:o}:(n=n.push(t),H(o.last(),{currentHistoryNode:t,undos:n,redos:o=o.pop()}))}({currentHistoryNode:e.currentHistoryNode,undos:e.undos,redos:e.redos});this.setState({currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos},this.saveDebounced.bind(this))}},{key:"goToHistoryNode",value:function(e){var t=this.state,n=H(e,{currentHistoryNode:t.currentHistoryNode,undos:t.undos,redos:t.redos});this.setState({currentHistoryNode:n.currentHistoryNode,undos:n.undos,redos:n.redos},this.saveDebounced.bind(this))}},{key:"render",value:function(){var e=this,t=this.state,n=t.selectedSwatch,o=t.selectedTool,a=t.palette,r=t.currentHistoryNode,i=t.dialog,c=[];return function(e){for(e.operation&&c.push(e.operation);e.parentNode;)(e=e.parentNode).operation&&c.push(e.operation);c.reverse()}(r),s.a.createElement("div",{className:"App"},s.a.createElement("main",null,s.a.createElement(Te,null,"\u26a0 This app is in very early stages of development. There are Big Plans. See the ",s.a.createElement("a",{href:"https://github.com/1j01/mopaint#mopaint",target:"_blank",rel:"noopener noreferrer"},"README on GitHub for more info"),"."),s.a.createElement("div",{id:"documents-options"},s.a.createElement("label",null,"Switch documents:\xa0",s.a.createElement("select",{value:this.props.documentID,onChange:function(t){return e.props.goToDocument(t.target.value)}},[this.props.documentID].concat(Object(h.a)(this.props.documentIDs.filter((function(t){return t!==e.props.documentID})))).map((function(e){return s.a.createElement("option",{value:e,key:e},"Untitled (",e,")")})))),s.a.createElement("hr",null),s.a.createElement("button",{id:"new-document",className:"toolbar-button",onClick:this.props.createNewDocument,"aria-label":"New Document",title:"New Document"},s.a.createElement(Ye,{width:"48px",height:"48px"})),s.a.createElement("button",{id:"save-document",className:"toolbar-button",onClick:function(){e.showSaveDialog()},"aria-label":"Save Document",title:"Save Document"},s.a.createElement(dt,{width:"48px",height:"48px"})),s.a.createElement("button",{id:"open-document",className:"toolbar-button",onClick:function(){e.openDocument()},"aria-label":"Open Document",title:"Open Document"},s.a.createElement(tt,{width:"48px",height:"48px"}))),s.a.createElement(Ee,{tools:he,selectedTool:o,selectTool:function(t){e.setState({selectedTool:t},e.saveDebounced.bind(e))}}),s.a.createElement(De,{palette:a,selectedSwatch:n,selectSwatch:function(t){e.setState({selectedSwatch:t},e.saveDebounced.bind(e))}}),s.a.createElement(we,{selectedSwatch:n,selectedTool:o,documentContext:this.documentContext,addOperation:this.addOperation.bind(this),updateOperation:this.updateOperation.bind(this),operations:c,thumbnailsByOperation:this.thumbnailsByOperation,ref:function(t){e.drawingCanvasComponent=t}})),s.a.createElement("div",{className:"sidebar"},s.a.createElement(He,{currentHistoryNode:this.state.currentHistoryNode,undos:this.state.undos,redos:this.state.redos,goToHistoryNode:this.goToHistoryNode.bind(this),thumbnailsByOperation:this.thumbnailsByOperation})),i)}},{key:"showError",value:function(e){e=Object(d.a)({isError:!0},e),window.console&&e.error&&console.error("(Error details:)",e.error),this.showMessage(e)}},{key:"showMessage",value:function(e){this.showDialog(s.a.createElement(Fe,{message:e.message,error:e.error,isError:e.isError,requestBugReport:e.requestBugReport,extraButtons:e.extraButtons,buttons:e.buttons,close:this.closeDialog.bind(this)}))}},{key:"showDialog",value:function(e){this.setState({dialog:e})}},{key:"closeDialog",value:function(){this.setState({dialog:null})}},{key:"showSaveDialog",value:function(){var e=this.createPNGram.bind(this),t=this.createRawPNG.bind(this),n=this.closeDialog.bind(this),o=this.showError.bind(this),a=this.state,r=document.createElement("a");r.className="for-downloading-files",r.tabIndex=-1,document.body.appendChild(r),this.showDialog(s.a.createElement((function(){var i=Object(c.useState)("hybrid"),l=Object(m.a)(i,2),u=l[0],d=l[1],h=Object(c.useState)("Drawing"),f=Object(m.a)(h,2),p=f[0],v=f[1],g=Object(c.useState)(null),w=Object(m.a)(g,2),y=w[0],b=w[1],E=function(e){b((function(t){return URL.revokeObjectURL(t),e}))},O=Object(c.useRef)(null),D={hybrid:"png","raw-image":"png",program:"mop"}[u],N=p.replace(new RegExp("\\."+D+"$","i"),"")+"."+D,I=function(){r.download=N,r.href=y,console.log("Download",y),r.click(),n()};return Object(c.useEffect)((function(){O.current.select()}),[]),Object(c.useEffect)((function(){return function(){E(null),r.remove()}}),[]),Object(c.useEffect)((function(){if(E(null),"hybrid"===u){var n=T(a);e(n,(function(e){var t=URL.createObjectURL(e);E(t)}),(function(){alert("Failed to save hybrid document (probably too large) - try the other save options.")}))}else if("raw-image"===u)t((function(e){var t=URL.createObjectURL(e);E(t)}));else if("program"===u){var r=T(a),i=new Blob([JSON.stringify(r)],{type:"application/x-mopaint+json"}),c=URL.createObjectURL(i);E(c)}else o({message:"This shouldn't happen, saveType=".concat(u),requestBugReport:!0})}),[u]),s.a.createElement(Fe,{message:s.a.createElement("div",{className:"save-dialog-message"},s.a.createElement("form",{className:"save-dialog-form",onSubmit:function(e){e.preventDefault(),I()}},s.a.createElement("label",null,"Name:"," ",s.a.createElement("input",{type:"text",value:p,autoFocus:!0,onChange:function(e){v(e.target.value)},ref:O})),s.a.createElement("div",{style:{marginTop:"1em"}},s.a.createElement("select",{value:u,onChange:function(e){return d(e.target.value)}},s.a.createElement("option",{value:"hybrid"},"Hybrid Mopaint Document and Image (.png)"),s.a.createElement("option",{value:"program"},"Mopaint Document (.mop)"),s.a.createElement("option",{value:"raw-image"},"Raw Image (.png)"))))),close:n,extraButtons:s.a.createElement("button",{onClick:I,disabled:!y},"Save ",y?"":"(please wait...)")})}),null))}}]),t}(c.Component),ft=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function pt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(70);"http:"===window.location.protocol&&window.location.host.match(/editor|app|mopaint/)&&(window.location.protocol="https:");var vt=function(e){return"".concat(window.location.origin).concat(window.location.pathname,"?document=").concat(e)},gt=function(e){window.location.search.match(/^\?./)?window.history.pushState({},null,vt(e)):window.history.replaceState({},null,vt(e)),Dt()},wt=function(){var e=i.a.generate();gt(e)},yt={serializedDocument:null,documentID:null},bt=function(e){var t=i.a.generate();yt={serializedDocument:e,documentID:t},console.log("Start new document (".concat(t,") from"),e),gt(t)},Et=[],Ot=function(){return a.a.keys().then((function(e){Et=e.map((function(e){return e.match(/document:([a-zA-Z0-9\-_]+):state/)})).filter((function(e){return e})).map((function(e){return e[1]})),Dt()}))},Dt=function(){var e,t=document.getElementById("root"),n=(window.location.search.match(/document=([\w\-./]*)/)||[])[1];n?(n===yt.documentID&&(e=yt.serializedDocument,yt={serializedDocument:null,documentID:null}),u.a.render(s.a.createElement(mt,{key:n,documentID:n,documentIDs:Et,goToDocument:gt,createNewDocument:wt,loadNewDocument:bt,serializedDocumentToLoad:e}),t)):wt()};window.addEventListener("popstate",Dt),Dt(),Ot(),setInterval(Ot,600),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");ft?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):pt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):pt(e)}))}}()}},[[29,1,2]]]);
//# sourceMappingURL=main.a68ff934.chunk.js.map